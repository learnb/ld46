!function o(r,h,a){function u(i,t){if(!h[i]){if(!r[i]){var s="function"==typeof require&&require;if(!t&&s)return s(i,!0);if(l)return l(i,!0);var e=new Error("Cannot find module '"+i+"'");throw e.code="MODULE_NOT_FOUND",e}var n=h[i]={exports:{}};r[i][0].call(n.exports,function(t){return u(r[i][1][t]||t)},n,n.exports,o,r,h,a)}return h[i].exports}for(var l="function"==typeof require&&require,t=0;t<a.length;t++)u(a[t]);return u}({1:[function(t,i,s){"function"==typeof Object.create?i.exports=function(t,i){t.super_=i,t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:i.exports=function(t,i){t.super_=i;function s(){}s.prototype=i.prototype,t.prototype=new s,t.prototype.constructor=t}},{}],2:[function(t,i,s){i.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],3:[function(t,i,f){var h=/%[sdj%]/g;f.format=function(t){if(!_(t)){for(var i=[],s=0;s<arguments.length;s++)i.push(a(arguments[s]));return i.join(" ")}s=1;for(var e=arguments,n=e.length,o=String(t).replace(h,function(t){if("%%"===t)return"%";if(n<=s)return t;switch(t){case"%s":return String(e[s++]);case"%d":return Number(e[s++]);case"%j":try{return JSON.stringify(e[s++])}catch(t){return"[Circular]"}default:return t}}),r=e[s];s<n;r=e[++s])m(r)||!u(r)?o+=" "+r:o+=" "+a(r);return o},f.deprecate=function(t,i){if(w(global.process))return function(){return f.deprecate(t,i).apply(this,arguments)};if(!0===process.noDeprecation)return t;var s=!1;return function(){if(!s){if(process.throwDeprecation)throw new Error(i);process.traceDeprecation?console.trace(i):console.error(i),s=!0}return t.apply(this,arguments)}};var e,n={};function a(t,i){var s={seen:[],stylize:r};return 3<=arguments.length&&(s.depth=arguments[2]),4<=arguments.length&&(s.colors=arguments[3]),x(i)?s.showHidden=i:i&&f._extend(s,i),w(s.showHidden)&&(s.showHidden=!1),w(s.depth)&&(s.depth=2),w(s.colors)&&(s.colors=!1),w(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=o),d(s,t,s.depth)}function o(t,i){var s=a.styles[i];return s?"["+a.colors[s][0]+"m"+t+"["+a.colors[s][1]+"m":t}function r(t,i){return t}function d(i,s,e){if(i.customInspect&&s&&E(s.inspect)&&s.inspect!==f.inspect&&(!s.constructor||s.constructor.prototype!==s)){var t=s.inspect(e,i);return _(t)||(t=d(i,t,e)),t}var n=function(t,i){if(w(i))return t.stylize("undefined","undefined");if(_(i)){var s="'"+JSON.stringify(i).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(s,"string")}if(g(i))return t.stylize(""+i,"number");if(x(i))return t.stylize(""+i,"boolean");if(m(i))return t.stylize("null","null")}(i,s);if(n)return n;var o,r=Object.keys(s),h=(o={},r.forEach(function(t,i){o[t]=!0}),o);if(i.showHidden&&(r=Object.getOwnPropertyNames(s)),S(s)&&(0<=r.indexOf("message")||0<=r.indexOf("description")))return $(s);if(0===r.length){if(E(s)){var a=s.name?": "+s.name:"";return i.stylize("[Function"+a+"]","special")}if(b(s))return i.stylize(RegExp.prototype.toString.call(s),"regexp");if(M(s))return i.stylize(Date.prototype.toString.call(s),"date");if(S(s))return $(s)}var u,l="",c=!1,p=["{","}"];y(s)&&(c=!0,p=["[","]"]),E(s)&&(l=" [Function"+(s.name?": "+s.name:"")+"]");return b(s)&&(l=" "+RegExp.prototype.toString.call(s)),M(s)&&(l=" "+Date.prototype.toUTCString.call(s)),S(s)&&(l=" "+$(s)),0!==r.length||c&&0!=s.length?e<0?b(s)?i.stylize(RegExp.prototype.toString.call(s),"regexp"):i.stylize("[Object]","special"):(i.seen.push(s),u=c?function(i,s,e,n,t){for(var o=[],r=0,h=s.length;r<h;++r)k(s,String(r))?o.push(v(i,s,e,n,String(r),!0)):o.push("");return t.forEach(function(t){t.match(/^\d+$/)||o.push(v(i,s,e,n,t,!0))}),o}(i,s,e,h,r):r.map(function(t){return v(i,s,e,h,t,c)}),i.seen.pop(),function(t,i,s){if(60<t.reduce(function(t,i){return 0<=i.indexOf("\n")&&0,t+i.replace(/\u001b\[\d\d?m/g,"").length+1},0))return s[0]+(""===i?"":i+"\n ")+" "+t.join(",\n  ")+" "+s[1];return s[0]+i+" "+t.join(", ")+" "+s[1]}(u,l,p)):p[0]+l+p[1]}function $(t){return"["+Error.prototype.toString.call(t)+"]"}function v(t,i,s,e,n,o){var r,h,a;if((a=Object.getOwnPropertyDescriptor(i,n)||{value:i[n]}).get?h=a.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):a.set&&(h=t.stylize("[Setter]","special")),k(e,n)||(r="["+n+"]"),h||(t.seen.indexOf(a.value)<0?-1<(h=m(s)?d(t,a.value,null):d(t,a.value,s-1)).indexOf("\n")&&(h=o?h.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+h.split("\n").map(function(t){return"   "+t}).join("\n")):h=t.stylize("[Circular]","special")),w(r)){if(o&&n.match(/^\d+$/))return h;r=(r=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(r=r.substr(1,r.length-2),t.stylize(r,"name")):(r=r.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(r,"string"))}return r+": "+h}function y(t){return Array.isArray(t)}function x(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return"number"==typeof t}function _(t){return"string"==typeof t}function w(t){return void 0===t}function b(t){return u(t)&&"[object RegExp]"===s(t)}function u(t){return"object"==typeof t&&null!==t}function M(t){return u(t)&&"[object Date]"===s(t)}function S(t){return u(t)&&("[object Error]"===s(t)||t instanceof Error)}function E(t){return"function"==typeof t}function s(t){return Object.prototype.toString.call(t)}function l(t){return t<10?"0"+t.toString(10):t.toString(10)}f.debuglog=function(i){if(w(e)&&(e=process.env.NODE_DEBUG||""),i=i.toUpperCase(),!n[i])if(new RegExp("\\b"+i+"\\b","i").test(e)){var s=process.pid;n[i]=function(){var t=f.format.apply(f,arguments);console.error("%s %d: %s",i,s,t)}}else n[i]=function(){};return n[i]},(f.inspect=a).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},f.isArray=y,f.isBoolean=x,f.isNull=m,f.isNullOrUndefined=function(t){return null==t},f.isNumber=g,f.isString=_,f.isSymbol=function(t){return"symbol"==typeof t},f.isUndefined=w,f.isRegExp=b,f.isObject=u,f.isDate=M,f.isError=S,f.isFunction=E,f.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},f.isBuffer=t("./support/isBuffer");var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function k(t,i){return Object.prototype.hasOwnProperty.call(t,i)}f.log=function(){var t,i;console.log("%s - %s",(t=new Date,i=[l(t.getHours()),l(t.getMinutes()),l(t.getSeconds())].join(":"),[t.getDate(),c[t.getMonth()],i].join(" ")),f.format.apply(f,arguments))},f.inherits=t("inherits"),f._extend=function(t,i){if(!i||!u(i))return t;for(var s=Object.keys(i),e=s.length;e--;)t[s[e]]=i[s[e]];return t}},{"./support/isBuffer":2,inherits:1}],4:[function(t,i,s){"use strict";function e(t){this.id=t,this.volume=1,this.muted=!0,this.loopSound=null,this.loopId=null,this.loopVol=0,this.nextLoop=null}(i.exports=e).prototype.setVolume=function(t,i){var s=this.muted;this.muted=0===t||i||!1,null!=t?this.volume=t:t=this.volume,this.loopId&&(this.loopSound&&this.muted?this.loopSound.stop():this.loopSound&&this.loopSound.id===this.loopId?(this.loopSound.setVolume(Math.max(0,Math.min(1,t*this.loopVol))),s&&this.loopSound.play()):this.muted||this.audioManager.playLoopSound(this.id,this.loopId,this.loopVol))},e.prototype.setMute=function(t){this.setVolume(null,t)},e.prototype.playLoopSound=function(t,s,e,n,o,r){var h=this.audioManager,a=h.settings.defaultFade,i=h.settings.crossFading,u=this.loopSound,l=u&&u.id;if(s=Math.max(0,Math.min(1,s||1)),this.loopId=t,this.loopVol=s,!h.muted&&!this.muted){if(t===l&&u)return u.play(s*this.volume,e,n),void(this.nextLoop&&(this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=null));if(u=null,!this.nextLoop||this.nextLoop.id!==t){var c=this;i?(this.nextLoop&&this.nextLoop.cancelOnLoadCallbacks(),this.nextLoop=h.createSound(t,this.id),this.nextLoop.load(function(t){if(t)return c.nextLoop.unload(),void(c.nextLoop=null);p(c.loopSound),d()})):(this.nextLoop=h.createSound(t,this.id),p(this.loopSound,d))}}function p(t,i){if(!t)return i&&i();t.stopping||t.stop(function(){return h.freeSound(t),t=null,i&&i()})}function f(){var i=c.loopSound=c.nextLoop;c.nextLoop=null,i&&(i.setLoop(!0,o,r),i.fade=a,i.load(function(t){if(t)return i.unload(),void(c.loopSound=null);i.play(s*c.volume,e,n)}))}function d(){c.loopSound=null,window.setTimeout(f,0)}}},{}],5:[function(t,i,s){"use strict";var e=window.AudioContext||window.webkitAudioContext,n=t("./OrderedList"),o=t("./SoundBuffered.js"),r=t("./SoundGroup.js"),h=t("./AudioChannel.js"),a=t("./ISound.js");function u(t){this.soundsById={},this.soundGroupsById={},this.permanentSounds={},this.freeSoundPool=[],this.soundArchive=new n(function(){return 1}),this.soundGroupArchive=new n(function(){return 1}),this.soundArchiveById={},this.soundGroupArchiveById={},this.usedMemory=0,this.channels={},this.audioContext=null,this.muted=!1,this.settings={audioPath:"",maxSoundGroup:500,maxUsedMemory:300,defaultFade:2,maxPlayLatency:1e3,crossFading:!1,getFileUri:function(t,i){return t+i+".mp3"},getSoundConstructor:function(){return null}};for(var i=0;i<t.length;i++){var s=t[i];this.channels[s]=new h(s)}a.prototype.audioManager=this,r.prototype.audioManager=this,h.prototype.audioManager=this}e||(console.warn("Web Audio API is not supported on this platform. Fallback to regular HTML5 <Audio>"),o=t("./Sound.js"),window.Audio||(console.warn("HTML5 <Audio> is not supported on this platform. Sound features are unavailable."),o=a)),i.exports=u,i.exports.ISound=a,u.prototype.init=function(){if(!this.audioContext&&e)for(var t in this.audioContext=new e,o.prototype.audioContext=this.audioContext,this.soundsById)this.soundsById[t].init()},u.prototype.getEmptySound=function(t,i){var s,e=this.settings.getSoundConstructor(t,i);return e?s=new e:(0<this.freeSoundPool.length?(s=this.freeSoundPool.pop()).init():s=new o,s)},u.prototype.setup=function(t){for(var i in t){var s=t[i];this.setVolume(i,s.volume,s.muted)}},u.prototype.addChannel=function(t){this.channels[t]||(this.channels[t]=new h(t))},u.prototype.setVolume=function(t,i,s){var e=this.channels[t];e&&e.setVolume(i,s)},u.prototype.setMute=function(t){for(var i in void 0===t&&(t=!this.muted),this.muted=!!t,this.channels){var s=this.channels[i];if(s.loopSound)if(t)s.loopSound.stop();else{var e=s.muted;s.muted=!0,s.setVolume(null,e)}}},u.prototype.loadSound=function(t,i){var s=this.createSound(t);return s.load(i),s},u.prototype.createSound=function(t,i){var s=this.getSound(t);return s||((s=this.soundsById[t]=this.getEmptySound(i,t)).setId(t),s)},u.prototype.createSoundPermanent=function(t,i){var s=this.getSound(t);if(s)return s;var e=this.settings.getSoundConstructor(i,t)||o;return(s=this.permanentSounds[t]=new e).setId(t),s},u.prototype.getSound=function(t){var i=this.permanentSounds[t];return i||((i=this.soundsById[t])?i:(i=this.soundArchiveById[t])?(this.soundArchive.removeByRef(i.poolRef),i.poolRef=null,delete this.soundArchiveById[t],this.soundsById[t]=i):null)},u.prototype.getSoundGroup=function(t){var i=this.soundGroupsById[t];return i||((i=this.soundGroupArchiveById[t])?(this.soundGroupArchive.removeByRef(i.poolRef),i.poolRef=null,delete this.soundGroupArchiveById[t],i.verifySounds(),this.soundGroupsById[t]=i):null)},u.prototype.freeSound=function(t){var i=t.id;this.soundsById[i]&&delete this.soundsById[i],this.soundArchiveById[i]&&(this.soundArchive.removeByRef(t.poolRef),t.poolRef=null,delete this.soundArchiveById[i]),t.unload(),t instanceof o&&this.freeSoundPool.push(t)},u.prototype.playLoopSound=function(t,i,s,e,n,o,r){var h=this.channels[t];if(!h)return console.warn('Channel id "'+t+'" does not exist.');h.playLoopSound(i,s,e,n,o,r)},u.prototype.stopLoopSound=function(t){var i=this,s=this.channels[t];if(!s)return console.warn('Channel id "'+t+'" does not exist.');var e=s.loopSound;s.loopId=null,e&&e.stop(function(){i.freeSound(e),s.loopSound=null})},u.prototype.stopAllLoopSounds=function(){for(var t in this.channels)this.stopLoopSound(t)},u.prototype.release=function(){var t,i,s,e=this.settings.maxSoundGroup,n=this.settings.maxUsedMemory,o={};for(t in this.channels){var r=this.channels[t];r.loopSound&&(o[r.loopSound.id]=!0)}for(t in this.soundGroupsById)(i=this.soundGroupsById[t]).poolRef=this.soundGroupArchive.add(i),this.soundGroupArchiveById[t]=i,delete this.soundGroupsById[t];for(t in this.soundsById)o[t]||((s=this.soundsById[t]).poolRef=this.soundArchive.add(s),this.soundArchiveById[t]=s,delete this.soundsById[t]);for(var h=this.soundGroupArchive.getCount();e<h&&(i=this.soundGroupArchive.popFirst());)i.poolRef=null,delete this.soundGroupArchiveById[i.id],--h;for(;this.usedMemory>n&&(s=this.soundArchive.popFirst());)s.poolRef=null,delete this.soundArchiveById[s.id],this.freeSound(s)},u.prototype.playSound=function(t,i,s,e,n){if(!this.muted){var o=this.channels[t];if(!o.muted){var r=this.getSound(i);s=s||1,(r=r||this.createSound(i,t)).play(o.volume*s,e,n)}}},u.prototype.playSoundGroup=function(t,i,s,e,n){if(!this.muted){var o=this.channels[t];if(o&&!o.muted){var r=this.getSoundGroup(i);if(!r)return console.warn('SoundGroup "'+i+'" does not exist.');s=s||1,r.play(s*o.volume,e,n)}}},u.prototype.createSoundGroup=function(t,i,s){if(!this.getSoundGroup(t)){var e=new r(t,i.id,i.vol,i.pitch,s);this.soundGroupsById[t]=e}},u.prototype.createSoundGroups=function(t,i){var s=void 0!==i&&this.channels[i].muted;for(var e in t)this.createSoundGroup(e,t[e],s)}},{"./AudioChannel.js":4,"./ISound.js":6,"./OrderedList":7,"./Sound.js":8,"./SoundBuffered.js":9,"./SoundGroup.js":10}],6:[function(t,i,s){"use strict";function e(){this.playing=!1,this.stopping=!1,this.fade=0,this.usedMemory=0,this.poolRef=null,this.id=null,this.volume=1,this.pan=0,this.loop=!1,this.pitch=0,this._loaded=!1,this._loading=!1,this._unloading=!1,this._playTriggered=0,this._onLoadQueuedCallback=[]}(i.exports=e).prototype.setId=function(t){this.id=t,this._loaded=!1},e.prototype.load=function(t){return this.id?this._loaded?t&&t(null,this):(t&&this._onLoadQueuedCallback.push(t),this._loading?void 0:(this._loading=!0,this._load())):t&&t("noId")},e.prototype._finalizeLoad=function(t){var i=this.audioManager.settings.maxPlayLatency;this._loaded=!t,this._loading=!1;for(var s=0;s<this._onLoadQueuedCallback.length;s++)this._onLoadQueuedCallback[s](t,this);if(this._onLoadQueuedCallback=[],this._unloading)return this._unloading=!1,void this.unload();this._loaded&&this._playTriggered&&((this.loop||Date.now()-this._playTriggered<i)&&this._play(),this._playTriggered=0)},e.prototype.cancelOnLoadCallbacks=function(){this._onLoadQueuedCallback=[]},e.prototype.play=function(t,i,s){if(null!=t&&this.setVolume(t),null!=i&&this.setPan(i),!this._loaded)return this._playTriggered=Date.now(),void this.load();this.loop&&this.playing?this._updatePlayPitch(s):this._play(s)},e.prototype.init=function(){},e.prototype.setVolume=function(t){this.volume=t},e.prototype.setPan=function(t){this.pan=t},e.prototype.setLoop=function(t){this.loop=t},e.prototype.setPitch=function(t){this.pitch=t},e.prototype._updatePlayPitch=function(t){},e.prototype._play=function(t){this.playing=!0,console.log('ISound play call: "'+this.id+'"')},e.prototype.stop=function(t){return this.playing=!1,t&&t()},e.prototype._load=function(){return console.log("ISound load call: "+this.id),this._finalizeLoad(null)},e.prototype.unload=function(){return this._playTriggered=0,this.setLoop(!1),this.fade=0,this.pitch=0,this.stop(),this._loading?!(this._unloading=!0):(this.audioManager.usedMemory-=this.usedMemory,this.setVolume(1),this.setPan(0),this.id=null,this._loaded=!1,!(this.usedMemory=0))}},{}],7:[function(t,i,s){"use strict";function o(t,i,s,e){this.object=t,this.previous=i,this.next=s,this.container=e}function e(t){this.count=0,this.first=null,this.last=null,this.cmpFunc=t}e.prototype.add=function(t){var i=new o(t,null,null,this);if(this.count+=1,null===this.first)return this.first=i,this.last=i;var s=this.cmpFunc(t,this.first.object);if(s<0)return i.next=this.first,this.first.previous=i,this.first=i;var e,n=this.cmpFunc(t,this.last.object);if(0<=n)return i.previous=this.last,this.last.next=i,this.last=i;if(s+n<0){for(e=this.first.next;0<=this.cmpFunc(t,e.object);)e=e.next;i.next=e,i.previous=e.previous,i.previous.next=i,e.previous=i}else{for(e=this.last.previous;this.cmpFunc(t,e.object)<0;)e=e.previous;i.previous=e,i.next=e.next,i.next.previous=i,e.next=i}return i},e.prototype.removeByRef=function(t){return!(!t||t.container!==this)&&(--this.count,null===t.previous?this.first=t.next:t.previous.next=t.next,null===t.next?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=null,!(t.container=null))},e.prototype.moveToTheBeginning=function(t){return!(!t||t.container!==this)&&(null===t.previous||(t.previous.next=t.next,this.last===t?this.last=t.previous:t.next.previous=t.previous,t.previous=null,t.next=this.first,t.next.previous=t,this.first=t),!0)},e.prototype.moveToTheEnd=function(t){return!(!t||t.container!==this)&&(null===t.next||(t.next.previous=t.previous,this.first===t?this.first=t.next:t.previous.next=t.next,t.next=null,t.previous=this.last,t.previous.next=t,this.last=t),!0)},e.prototype.possess=function(t){return t&&t.container===this},e.prototype.popFirst=function(){var t=this.first;if(!t)return null;--this.count;var i=t.object;return this.first=t.next,null!==this.first&&(this.first.previous=null),t.next=null,t.container=null,i},e.prototype.popLast=function(){var t=this.last;if(!t)return null;--this.count;var i=t.object;return this.last=t.previous,null!==this.last&&(this.last.next=null),t.previous=null,t.container=null,i},e.prototype.getFirst=function(){return this.first&&this.first.object},e.prototype.getLast=function(){return this.last&&this.last.object},e.prototype.clear=function(){for(var t=this.first;t;t=t.next)t.container=null;this.count=0,this.first=null,this.last=null},e.prototype.getCount=function(){return this.count},e.prototype.forEach=function(t,i){for(var s=this.first;s;s=s.next)t(s.object,i)},e.prototype.forEachReverse=function(t,i){for(var s=this.last;s;s=s.previous)t(s.object,i)},e.prototype.reposition=function(t){if(t.container!==this)return this.add(t.object);var i=t.previous,s=t.next,e=t.object;for(null===s?this.last=i:s.previous=i,null===i?this.first=s:i.next=s;null!==i&&this.cmpFunc(e,i.object)<0;)i=(s=i).previous;for(;null!==s&&0<=this.cmpFunc(e,s.object);)s=(i=s).next;return null===(t.next=s)?this.last=t:s.previous=t,null===(t.previous=i)?this.first=t:i.next=t,t},i.exports=e},{}],8:[function(t,i,s){"use strict";var e=t("util").inherits,n=t("./ISound.js"),o={playAudioWhenScreenIsLocked:!1};function r(){n.call(this);var t=new Audio;t.loop=!1,t.type="audio/mpeg",this._audio=t,this.audioContext&&(this.source=this.audioContext.createMediaElementSource(t),this.source.connect(this.audioContext.destination))}e(r,n),(i.exports=r).prototype.setVolume=function(t){this.volume=this._audio.volume=t},r.prototype.setLoop=function(t){this.loop=this._audio.loop=t},r.prototype._load=function(){var i=this;function s(t){i._finalizeLoad(t)}function e(){this.removeEventListener("canplaythrough",e),this.removeEventListener("error",n),i.usedMemory=this.duration,i.audioManager.usedMemory+=this.duration,i._finalizeLoad(null)}function n(t){this.removeEventListener("canplaythrough",e),this.removeEventListener("error",n),s(t)}function o(t){i._loading=!0,i._audio.addEventListener("canplaythrough",e),i._audio.addEventListener("error",n),i._audio.src=t,i._audio.load()}var t=this.audioManager.settings.getFileUri,r=this.audioManager.settings.audioPath;if(2<t.length)t(r,this.id,function(t,i){if(t)return s(t);o(i)});else try{var h=t(r,this.id);if(!h)return s("emptyUri");o(h)}catch(t){s(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._audio.volume=1,this._audio.src="",this._audio.load())},r.prototype._play=function(t){this._audio.volume=this.volume,this._audio.pause(),this._audio.currentTime=0,this._audio.play(o),this.playing=!0},r.prototype.stop=function(t){return this._audio.pause(),this._audio.currentTime=0,this._playTriggered=0,this.playing=!1,t&&t()}},{"./ISound.js":6,util:3}],9:[function(t,i,s){"use strict";var e=t("util").inherits,n=t("./ISound.js"),o=1e-6;function r(){n.call(this),this.buffer=null,this.source=null,this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._playPitch=0,this._fadeTimeout=null,this._onStopCallback=null,this._audioNodeReady=!1,this._loopStart=0,this._loopEnd=0,this.init()}e(r,n),(i.exports=r).prototype._createAudioNodes=function(){if(!this._audioNodeReady&&this.audioContext){var t,i=this.audioContext,s=i.createGain();t=i.createStereoPanner?i.createStereoPanner():i.createPanner(),s.connect(t),t.connect(i.destination),s.gain.value=0,this.sourceConnector=s,this.gain=s.gain,this.panNode=t,this._audioNodeReady=!0}},r.prototype._destroyAudioNodes=function(){if(this._audioNodeReady){var t=this.audioContext,i=this.panNode,s=this.sourceConnector;s.disconnect(i),i.disconnect(t.destination),this.source&&(this.source.disconnect(s),this.source.onended=null,this.source=null),this.sourceConnector=null,this.gain=null,this.panNode=null,this.rawAudioData=null,this._audioNodeReady=!1}},r.prototype.init=function(){if(this._createAudioNodes(),this.rawAudioData){var i=this,s=this.audioManager.settings.maxPlayLatency;this.audioContext.decodeAudioData(this.rawAudioData,function(t){i.buffer=t,i.usedMemory=t.duration,i.audioManager.usedMemory+=t.duration,i.rawAudioData=null,i._loaded&&i._playTriggered&&((i.loop||Date.now()-i._playTriggered<s)&&i._play(),i._playTriggered=0)},function(){console.error("decode audio failed for sound ",i.id)})}},r.prototype.setVolume=function(t){if(this.volume=t,this.playing)if(this.fade){t<=0&&(t=o);var i=this.audioContext.currentTime;this.gain.cancelScheduledValues(i),this.gain.setValueAtTime(this.gain.value||o,i),this.gain.linearRampToValueAtTime(t,i+this.fade)}else this.gain.value=t},r.prototype.setPan=function(t){this.pan=t,this.panNode&&(this.panNode.pan?this.panNode.pan.value=t:this.panNode.setPosition(t,0,.2))},r.prototype.setLoop=function(t,i,s){this.loop=!!t,this._loopStart=i||0,this._loopEnd=s||0,this.source&&this.buffer&&(this.source.loop=t,this._setLoopPoints())},r.prototype._setLoopPoints=function(){this.source.loopStart=this._loopStart||0;var t=this._loopEnd;t<0&&(t=this.buffer.duration+t),t<0&&(t=0),this.source.loopEnd=t||this.buffer.duration},r.prototype.setPitch=function(t,i){this.pitch=t,this._setPlaybackRate(i)},r.prototype._updatePlayPitch=function(t){!t&&0!==t||t===this._playPitch||(this._playPitch=t,this._setPlaybackRate(0))},r.prototype._setPlaybackRate=function(t){if(this.source){var i=Math.pow(2,(this._playPitch+this.pitch)/12);if(t){var s=this.audioContext.currentTime;this.source.playbackRate.cancelScheduledValues(s),this.source.playbackRate.setValueAtTime(this.source.playbackRate.value||o,s),this.source.playbackRate.linearRampToValueAtTime(i,s+t)}else this.source.playbackRate.value=i}},r.prototype._load=function(){var s=this;function e(t){s._finalizeLoad(t)}function n(t){s.buffer=t,s.usedMemory=t.duration,s.audioManager.usedMemory+=t.duration,s._finalizeLoad(null)}function o(t){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=function(){if(4==~~i.readyState)return 200!=~~i.status&&0!=~~i.status?e("xhrError:"+i.status):void(s.audioContext?s.audioContext.decodeAudioData(i.response,n,e):(s.rawAudioData=i.response,s._finalizeLoad(null)))},i.open("GET",t,!0),i.send()}this._createAudioNodes();var t=this.audioManager.settings.getFileUri,i=this.audioManager.settings.audioPath;if(2<t.length)t(i,this.id,function(t,i){if(t)return e(t);o(i)});else try{var r=t(i,this.id);if(!r)return e("emptyUri");o(r)}catch(t){e(t)}},r.prototype.unload=function(){n.prototype.unload.call(this)&&(this._fadeTimeout&&(this._onStopCallback=null,this._stopAndClear()),this.buffer=null,this.source&&(this.source.onended=null,this.source.stop(0),this.source=null),this._destroyAudioNodes())},r.prototype._play=function(t){if(this.buffer){this.playing=!0;var i=this.audioContext.currentTime;if(this.gain.cancelScheduledValues(i),this.fade?(this.gain.setValueAtTime(this.gain.value||o,i),this.gain.linearRampToValueAtTime(this.volume||o,i+this.fade)):this.gain.value=this.volume,this._fadeTimeout)return this._onStopCallback=null,this.source.onended=null,this.stopping=!1,window.clearTimeout(this._fadeTimeout),void(this._fadeTimeout=null);this.source&&(this.source.disconnect(this.sourceConnector),this.source.onended=null);var s=this.source=this.audioContext.createBufferSource();s.connect(this.sourceConnector);var e=this;s.onended=function(){e.playing=!1,s.onended=null,e.source=null},this._playPitch=t||0,(t||this.pitch)&&this._setPlaybackRate(0),s.loop=this.loop,s.buffer=this.buffer,this._setLoopPoints(),s.start(0)}else this._playTriggered=Date.now()},r.prototype._stopAndClear=function(){this.stopping=!1,this.source.onended=null,this.source.stop(0),this.source=null,this._fadeTimeout&&(window.clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this._onStopCallback&&(this._onStopCallback(),this._onStopCallback=null)},r.prototype.stop=function(t){if(!this.playing&&!this.stopping)return t&&t();if(this._playTriggered=0,this.stopping=!0,this.playing=!1,!this.source)return t&&t();if(this._onStopCallback=t,!this._fadeTimeout){if(this.fade){var i=this,s=this.audioContext.currentTime;return this.gain.cancelScheduledValues(s),this.gain.setValueAtTime(this.gain.value||o,s),this.gain.linearRampToValueAtTime(o,s+this.fade),void(this._fadeTimeout=window.setTimeout(function(){i._fadeTimeout=null,i._stopAndClear()},1e3*this.fade))}this._stopAndClear()}}},{"./ISound.js":6,util:3}],10:[function(t,i,s){"use strict";function e(t,i,s,e,n){this.id=t,this.soundIds=i,this.volumes=s||[],this.pitches=e||[],this.soundIndex=0,this.volIndex=0,this.pitchIndex=0,this.poolRef=null,this._ready=!1,0===this.volumes.length&&this.volumes.push(1),0===this.pitches.length&&this.pitches.push(0),n||this._createSounds()}(i.exports=e).prototype._createSounds=function(){for(var t=this.soundIds,i=0;i<t.length;i++)this.audioManager.loadSound(t[i]);this._ready=!0},e.prototype.play=function(t,i,s){if(0!==this.soundIds.length){this._ready||this._createSounds();var e=this.soundIds[this.soundIndex++],n=this.audioManager.getSound(e);if(!n)return console.warn("[Sound Group: "+this.id+"] sound id "+e+"  cannot be played.");t=t||1,s=s||0,t*=this.volumes[this.volIndex++],s+=this.pitches[this.pitchIndex++],n.play(t,i,s),this.soundIndex>=this.soundIds.length&&(this.soundIndex=0),this.volIndex>=this.volumes.length&&(this.volIndex=0),this.pitchIndex>=this.pitches.length&&(this.pitchIndex=0)}},e.prototype.verifySounds=function(){for(var t=0;t<this.soundIds.length;t++){var i=this.soundIds[t];this.audioManager.createSound(i)}}},{}],11:[function(t,i,s){"use strict";var r=/rgba?\(\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,\s*([.0-9]+)\s*,?\s*([.0-9]+)?\s*\)/;function e(){this.r=0,this.g=0,this.b=0,this.a=void 0,this.string=""}(i.exports=e).prototype._setRGB=function(t,i,s){this.r=t,this.g=i,this.b=s},e.prototype.fromPixel=function(t,i){var s=t[i+0],e=t[i+1],n=t[i+2];return this.string="rgb("+s+","+e+","+n+")",this._setRGB(s,e,n),this},e.prototype.fromString=function(t){var i,s,e,n=(this.string=t).match(r);if(n)i=~~n[1],s=~~n[2],e=~~n[3],this._setRGB(i,s,e);else{var o="0x"+t.slice(1).replace(t.length<5&&/./g,"$&$&");this._setRGB(o>>16,o>>8&255,255&o)}return this},e.prototype.fromRGB=function(t,i,s){return this._setRGB(t,i,s),this.string="rgb("+t+","+i+","+s+")",this},e.prototype.fromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this.string=t.string,this}},{}],12:[function(t,i,s){"use strict";var e=t("./index"),n=t("../domUtils/createCanvas"),u=~~settings.tileSize.width,l=~~settings.tileSize.height,$=Math.PI/2;e.setTileSize=function(t,i){u=~~t,l=~~i},e.prototype._init=function(){this.canvas=n(this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle=this.palette[0].string,this.ctx.strokeStyle=this.palette[1].string,this.resize(this.width,this.height)},e.prototype.resize=function(t,i){return this.canvas.width=this.width=t,this.canvas.height=this.height=i,this.clear(),this},e.prototype.sprite=function(t,i,s,e,n,o){var r=u*(t%16),h=l*~~(t/16),a=this.ctx;return i=i||0,s=s||0,i=~~Math.round(i-this.camera.x),s=~~Math.round(s-this.camera.y),e||n||o?(a.save(),e&&(a.scale(-1,1),i=-i-u),n&&(a.scale(1,-1),s=-s-l),o?(a.translate(i+l,s),a.rotate($)):a.translate(i,s),a.drawImage(this.tilesheet,this.ox+r,this.oy+h,u,l,0,0,u,l),a.restore()):a.drawImage(this.tilesheet,this.ox+r,this.oy+h,u,l,i,s,u,l),this},e.prototype.draw=function(t,i,s,e,n,o){var r=e||n||o;if(t._isSprite){var h=t;t=h.img;var a=h.x,u=h.y,l=h.width,c=h.height,p=~~Math.round((i||0)-this.camera.x),f=~~Math.round((s||0)-this.camera.y);return r?((d=this.ctx).save(),o?(e&&(d.scale(-1,1),p*=-1,p-=c),n&&(d.scale(1,-1),f*=-1,f-=l),d.translate(p+c,f),d.rotate($)):(e&&(d.scale(-1,1),p*=-1,p-=l),n&&(d.scale(1,-1),f*=-1,f-=c),d.translate(p,f)),d.drawImage(t,a,u,l,c,0,0,l,c),d.restore(),this):(this.ctx.drawImage(t,a,u,l,c,p,f,l,c),this)}t._isTileMap&&(t.texture||t._prepareTexture(),t=t.texture.canvas),t._isTexture&&(t=t.canvas);var d;p=~~Math.round((i||0)-this.camera.x),f=~~Math.round((s||0)-this.camera.y);return r?((d=this.ctx).save(),o?(e&&(d.scale(-1,1),p*=-1,p-=t.height),n&&(d.scale(1,-1),f*=-1,f-=t.width),d.translate(p+t.height,f),d.rotate($)):(e&&(d.scale(-1,1),p*=-1,p-=t.width),n&&(d.scale(1,-1),f*=-1,f-=t.height),d.translate(p,f)),d.drawImage(t,0,0),d.restore()):this.ctx.drawImage(t,p,f),this},e.prototype.clear=function(){return this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this},e.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this},e.prototype.pen=function(t){return this._pen=t%this.palette.length,this.ctx.strokeStyle=this.palette[this._pen].string,this},e.prototype.paper=function(t){return this._paper=t%this.palette.length,this.ctx.fillStyle=this.palette[this._paper].string,this},e.prototype.rect=function(t,i,s,e){return this.ctx.strokeRect(.5+~~(t-this.camera.x),.5+~~(i-this.camera.y),~~(s-1),~~(e-1)),this},e.prototype.rectf=function(t,i,s,e){return this.ctx.fillRect(~~(t-this.camera.x),~~(i-this.camera.y),~~s,~~e),this},e.prototype.rectfill=e.prototype.rectf,e.prototype._isTexture=!0,e.prototype.tilesheet=n(16*u,16*l)},{"../domUtils/createCanvas":18,"./index":13}],13:[function(t,i,s){"use strict";function e(t,i){this.width=t,this.height=i,this.camera={x:0,y:0},this._cursor={i:0,j:0},this._paper=0,this._pen=1,this._init()}function n(t,i){t.ox=0,t.oy=0,i._isImageWrapper&&(i=i.asset),i._isSprite?(t.ox=i.x,t.oy=i.y,t.tilesheet=i.img):i._isMap?(i.texture||i._prepareTexture(),t.tilesheet=i.texture.canvas):i._isTexture?t.tilesheet=i.canvas:(i instanceof Image||i instanceof HTMLCanvasElement)&&(t.tilesheet=i)}(i.exports=e).prototype.palette=[{string:"#000000",r:0,g:0,b:0},{string:"#FFFFFF",r:1,g:1,b:1}],e.prototype.ox=0,e.prototype.oy=0,e.prototype.setPalette=function(t){e.prototype.palette=t},e.prototype.setGlobalTilesheet=function(t){n(e.prototype,t)},e.prototype.setTilesheet=function(t){if(t)return n(this,t),this;delete this.tilesheet},e.prototype.setCamera=function(t,i){return this.camera.x=t||0,this.camera.y=i||0,this}},{}],14:[function(t,i,s){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var e=t("./index.js"),u=3,l=5,n=e.prototype.setPalette;e.prototype.setPalette=function(t){n.call(this,t),e.prototype.textCharset=new e(128*u,l*t.length),function(t,i){for(var s=[219,438,511,14016,14043,14326,14335,28032,28123,28086,28159,32704,32731,32758,32767,128,146,384,402,9344,9362,9600,9618,192,210,448,466,9408,9426,9664,9682,32767,0,8338,45,11962,5588,21157,29354,10,17556,5265,21973,1488,5312,448,13824,5268,31599,29843,29671,31143,18925,31183,31689,18735,31727,18927,1040,5136,17492,3640,5393,8359,25450,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25750,17553,13459,9402,28672,34,23530,31467,25166,15211,29391,4815,27470,23533,29847,15142,23277,29257,23421,23403,11114,4843,26474,23279,14798,9367,27501,12141,24429,23213,14829,29351,25686,9362,13587,42,21845],e=0;e<i.length;e++){t.fillStyle=i[e].string;for(var n=0;n<s.length;n++)for(var o=s[n],r=0;r<15;r++){var h=r%u,a=~~(r/u);1==(o>>r&1)&&t.fillRect(n*u+h,e*l+a,1,1)}}t.fillStyle=i[0].string}(e.prototype.textCharset.ctx,t)};var r=e.prototype.resize;e.prototype.resize=function(t,i){return this._textOffset=1,this._textColumn=~~(t/4),this._textLine=~~(i/6),this._textPadding=i-6*this._textLine-this._textOffset,this._cursor.i=0,this._cursor.j=0,r.call(this,t,i),this},e.prototype.cls=function(){return this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.locate(0,0),this},e.prototype.textCharset=new e(128*u,l*e.prototype.palette.length),e.prototype.locate=function(t,i){return this._cursor.i=~~t,this._cursor.j=~~i,this},e.prototype.print=function(i,t,s){if("object"===o(i))try{i=JSON.stringify(i)}catch(t){i="[Object]"}else"string"!=typeof i&&(i=i.toString());if(void 0!==t){t=~~Math.round(t-this.camera.x),s=~~Math.round(s-this.camera.y);for(var e=0;e<i.length;e++)this.ctx.drawImage(this.textCharset.canvas,u*i.charCodeAt(e),l*this._pen,u,l,t,s,u,l),t+=4;return this}for(e=0;e<i.length;e++){this._cursor.j>=this._textLine&&this.textScroll();var n=i.charCodeAt(e);10!==n&&13!==n?(this.ctx.drawImage(this.textCharset.canvas,u*n,l*this._pen,u,l,4*this._cursor.i,6*this._cursor.j+this._textOffset,u,l),this._cursor.i+=1,this._cursor.i>this._textColumn&&(this._cursor.i=0,this._cursor.j+=1)):(this._cursor.i=0,this._cursor.j+=1)}return this},e.prototype.println=function(t){return this.print(t),this.print("\n"),this},e.prototype.textScroll=function(t){return void 0===t&&(t=1),this._cursor.j-=t,t*=6,this.ctx.drawImage(this.canvas,0,-t),this.ctx.fillRect(0,this.canvas.height-t-this._textPadding,this.canvas.width,t+this._textPadding),this}},{"./index.js":13}],15:[function(t,i,s){"use strict";var e=t("../Texture"),u=~~settings.tileSize.width,l=~~settings.tileSize.height;function c(t,i,s,e,n,o,r,h){this.x=~~t,this.y=~~i,this.sprite=~~s,this.flipH=!!e,this.flipV=!!n,this.flipR=!!o,this.flagA=!!r,this.flagB=!!h}function o(t,i){this._name="",this.width=0,this.height=0,this.items=[],this.texture=null,this.tilesheet=null,this._tilesheetPath="",t&&i&&this._init(t,i)}(i.exports=o).prototype._isTileMap=!0;var h,f,n={},r=[];o.getMap=function(t){return"string"==typeof t?n[t]:"number"==typeof t?r[t]:(console.error("Map does not exist",t),null)},o._checkBankFormat=function(t){return t?Array.isArray(t)?{_type:"maps",maps:t}:"maps"!==t._type?(console.warn("Map bank format incorrect"),{_type:"maps",maps:[]}):t:{_type:"maps",maps:[]}},o.loadBank=function(t){t=o._checkBankFormat(t),n={},r=[];for(var i=t.maps||[],s=0;s<i.length;s++)r.push((new o).load(i[s]))},o.setTileSize=function(t,i){u=~~t,l=~~i},Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(t){this._name&&n[this._name]&&n[this._name]===this&&delete n[this._name],(this._name=t)&&!n[t]&&(n[t]=this)}}),o.prototype._init=function(t,i){this.width=t,this.height=i,this.items=[];for(var s=0;s<t;s++){this.items.push([]);for(var e=0;e<i;e++)this.items[s][e]=null}this.texture&&this.texture.resize(t*u,i*l)},o.prototype.resize=function(t,i){var s=this.items,e=Math.min(this.width,t),n=Math.min(this.height,i);this._init(t,i);for(var o=0;o<e;o++)for(var r=0;r<n;r++)this.items[o][r]=s[o][r];return this.redraw(),this},o.prototype.set=function(t,i,s,e,n,o,r,h){if(null==s)return this.remove(t,i);if(!(t<0||i<0||t>=this.width||i>=this.height)){var a=this.items[t][i]=new c(t,i,s,e,n,o,r,h);return this.texture&&(this.texture.ctx.clearRect(t*u,i*l,u,l),this.texture.sprite(a.sprite,a.x*u,a.y*l,a.flipH,a.flipV,a.flipR)),this}},o.prototype.remove=function(t,i){if(!(t<0||i<0||t>=this.width||i>=this.height))return this.items[t][i]=null,this.texture&&this.texture.ctx.clearRect(t*u,i*l,u,l),this},o.prototype.get=function(t,i){return t<0||i<0||t>=this.width||i>=this.height?null:this.items[t][i]},o.prototype.redraw=function(){if(!this.texture)return this;this.texture.clear();for(var t=0;t<this.width;t++)for(var i=0;i<this.height;i++){var s=this.items[t][i];s&&this.texture.sprite(s.sprite,s.x*u,s.y*l,s.flipH,s.flipV,s.flipR)}return this},o.prototype._prepareTexture=function(){this.texture=new e(this.width*u,this.height*l),this.texture.setTilesheet(this.tilesheet),this.redraw()},o.prototype.release=function(){this.texture=null},o.prototype.draw=function(t,i){this.texture||this._prepareTexture(),draw(this.texture,t,i)},o.prototype.setTilesheet=function(t){return this.tilesheet=t,this._tilesheetPath=t&&t.path||"",this.texture&&this.texture.setTilesheet(t),this.redraw(),this},o.prototype._setTilesheetPath=function(t){if(this._tilesheetPath=t||"",!t)return this.setTilesheet();for(var i=t.split("/"),s=window.assets||{},e=0;e<i.length;e++)if(!(s=s[i[e]]))return console.warn("Could not find tilesheet",t);this.setTilesheet(s)},function(){for(var s="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",u={},t=0;t<s.length;t++)u[s[t]]=t;var l=s.length,c=l*l-1,p=Math.pow(2,13),o=c-p-1;function r(t){var i=t%l;return s[~~(t/l)]+s[i]}h=function(t){for(var i="",s=0,e=0;e<t.length;e++){var n=t[e];n===t[e+1]&&++s<o||(null===n&&(n=c),i+=r(n),s===o&&s--,0!==s&&(i+=r(p+s)),s=0)}return s===o&&s--,0!==s&&(i+=r(p+s)),i},f=function(t){for(var i=[],s=0;s<t.length;){var e=t[s++],n=t[s++],o=u[e]*l+u[n];if(o===c)i.push(null);else if(p<o)for(var r=o-p,h=i[i.length-1],a=0;a<r;a++)i.push(h);else i.push(o)}return i}}(),o.prototype.save=function(){for(var t=this.width,i=this.height,s=new Array(t*i),e=0;e<t;e++)for(var n=0;n<i;n++){var o=this.items[e][n];s[e+n*t]=o?o.sprite+(o.flipH<<8)+(o.flipV<<9)+(o.flipR<<10)+(o.flagA<<11)+(o.flagB<<12):null}return{w:t,h:i,name:this.name,sheet:this._tilesheetPath||"",data:h(s)}},o.prototype.load=function(t){this.texture=null;var i=t.w,s=t.h;this._init(i,s),this.name=t.name||"",this._setTilesheetPath(t.sheet);for(var e=f(t.data),n=0;n<i;n++)for(var o=0;o<s;o++){var r=e[n+o*i];if(null!==r){var h=255&r,a=r>>8&1,u=r>>9&1,l=r>>10&1,c=r>>11&1,p=r>>12&1;this.set(n,o,h,a,u,l,c,p)}}return this},o.prototype.copy=function(t,i,s,e){t=t||0,i=i||0,null==s&&(s=this.width),null==e&&(e=this.height);var n=new o(s,e);return n.paste(this,-t,-i),n},o.prototype.paste=function(t,i,s,e){i=i||0,s=s||0;for(var n=Math.min(t.width,this.width-i),o=Math.min(t.height,this.height-s),r=Math.max(0,-i),h=Math.max(0,-s),a=r;a<n;a++)for(var u=h;u<o;u++){var l=t.items[a][u];if(l)this.set(a+i,u+s,l.sprite,l.flipH,l.flipV,l.flipR,l.flagA,l.flagB);else{if(e)continue;this.remove(a+i,u+s)}}return this},o.prototype.clear=function(){for(var t=0;t<this.width;t++)for(var i=0;i<this.height;i++)this.items[t][i]=null;return this.texture&&this.texture.clear(),this},o.prototype.find=function(t,i,s){if(null===t)return this._findNull();void 0===i&&(i=null),void 0===s&&(s=null);for(var e=[],n=0;n<this.width;n++)for(var o=0;o<this.height;o++){var r=this.items[n][o];if(r){var h=null===i||r.flagA===i,a=null===s||r.flagB===s;r.sprite===t&&h&&a&&e.push(r)}}return e},o.prototype._findNull=function(){for(var t=[],i=0;i<this.width;i++)for(var s=0;s<this.height;s++)null===this.items[i][s]&&t.push({x:i,y:s});return t}},{"../Texture":13}],16:[function(t,i,s){"use strict";function f(t,i){var s=new Image;s.onload=function(){this.onload=null,this.onerror=null,i&&i(null,this)},s.onerror=function(){this.onload=null,this.onerror=null,i&&i("img:"+t)},s.src=t}function d(t,i){var s=new Audio;function e(){i&&i(null,s),s.removeEventListener("canplaythrough",e),s.removeEventListener("error",n)}function n(){i&&i("snd:load"),s.removeEventListener("canplaythrough",e),s.removeEventListener("error",n)}s.preload=!0,s.loop=!1,s.addEventListener("canplaythrough",e),s.addEventListener("error",n),s.src=t,s.load()}s.loadData=function(t,i,s){var e=new XMLHttpRequest;e.responseType=i||"arraybuffer",e.onreadystatechange=function(){if(4==~~e.readyState)return 200!=~~e.status&&0!=~~e.status?s&&s("xhrError:"+e.status):s&&s(null,e.response)},e.open("GET",t,!0),e.send()},s.loadJson=function(t,i){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(4==~~s.readyState)return 200!=~~s.status?i("xhrError:"+s.status):i&&i(null,JSON.parse(s.response))},s.open("GET",t,!0),s.send()},s.loadImage=f,s.loadSound=d,s.preloadStaticAssets=function(e,n,o){var h=e.dat,r=e.img.length,a=r+e.snd.length,u=e.root,l=0,c=0;function p(){var s,t,i=l+c;o&&o(l,i,a,i/a),t=i<r?(s=e.img[i],f):(s=e.snd[i-r],d),c+=1,t(u+s,function(t,i){t||function(t,i){var s=t.split("/"),e=s.pop().split(".");e.pop(),e=e.join(".");for(var n=h,o=0,r=s.length;o<r;o++)n=n[s[o]];n[e]=i,s.push(e),i.name=e,i.path=s.join("/")}(s,i),(l+=1)+--c<a?p():0===c&&n(null,h)})}if(0===a)return n(null,h);for(var t=Math.min(5,a-1),i=0;i<=t;i++)p()}},{}],17:[function(t,i,s){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var e,n;e=window,n=function(){return e={},n.m=s=[function(t,i,s){var n=s(4);function e(){this.name="",this.speed=20,this.pmin=0,this.pmax=127,this.snap=!1,this.steps=[],this.audio=null}(t.exports=e).prototype.serialize=function(){for(var t="",i=0;i<this.steps.length;i++)t+=this.steps[i].serialize();return{n:this.name,i:[this.speed,this.pmin,this.pmax,~~this.snap],s:t}},e.prototype.deserialize=function(t){this.name=t.n,this.speed=t.i[0],this.pmin=t.i[1],this.pmax=t.i[2],this.snap=!!t.i[3],this.audio=null,this.steps=[];for(var i=t.s,s=0;s<i.length;s+=3){var e=new n;e.deserialize(i,s),this.steps.push(e)}return this},e.prototype.check=function(){11<this.name.length&&(this.name=this.name.substr(0,11)),this.speed=Math.max(0,Math.min(53,~~this.speed)),this.pmin=Math.max(0,Math.min(101,~~this.pmin)),this.pmax=Math.max(26,Math.min(127,~~this.pmax));for(var t=0;t<this.steps.length;t++)this.steps[t].check()}},function(t,i){i.SAMPLE_RATE=44100,i.CHUNK_LENGTH=50},function(t,i,s){var e=s(3),n=s(0),o=new(s(6)),r=audioManager.getEmptySound().__proto__.constructor;if(!r.prototype._createAudioNodes)throw new Error("webAudio required");function h(t){r.call(this),this._data=t}function a(t){var i=new h(t);return t.audio=i}inherits(h,r),h.prototype.load=function(t){if(this._loaded)return t&&t(null,this);t&&this._onLoadQueuedCallback.push(t),this.buffer=o.generateSound(this._data),this.usedMemory=this.buffer.duration,this.audioManager.usedMemory+=this.buffer.duration,this._finalizeLoad(null)},n.prototype.play=function(t,i,s){this.audio?this.audio.play(t,i,s):a(this).play(t,i,s)};var u=new e,l=[];i.loadProgram=function(t){u.deserialize(t),assets.bleeper={};for(var i=l.length=0;i<u.sounds.length;i++){var s=u.sounds[i],e=a(s);l.push(e);var n=s.name;n&&(assets.bleeper[n]=e,audioManager.permanentSounds[n]=e)}return u},i.sounds=l},function(t,i,s){var n=s(0);function e(){this.version=1,this.sounds=[]}(t.exports=e).prototype.serialize=function(){for(var t=[],i=0;i<this.sounds.length;i++)t.push(this.sounds[i].serialize());return{_type:"Bleeper program",v:this.version,s:t}},e.prototype.deserialize=function(t){if("Bleeper program"!==t._type)throw new Error("Incorrect data type");this.version=t.v,this.sounds.length=0;for(var i=t.s,s=0;s<i.length;s++){var e=new n;e.deserialize(i[s]),this.sounds.push(e)}return this},e.prototype.check=function(){if(0!==this.sounds.length)for(var t=0;t<this.sounds.length;t++)this.sounds[t].check();else this.sounds.push(new n)}},function(t,i,s){var n=s(5);function e(){this.wave=0,this.pitch=0,this.volume=0}(t.exports=e).prototype.serialize=function(){var t=this.wave,i=this.pitch;return 92<this.pitch&&(t+=8,i-=92),n.encodeUint6(t)+n.encodeUint6(i)+n.encodeUint6(this.volume)},e.prototype.deserialize=function(t,i){var s=n.decodeUint6(t,i),e=n.decodeUint6(t,i+1);return this.volume=n.decodeUint6(t,i+2),8<=s&&(s-=8,e+=92),this.wave=s,this.pitch=e,this},e.prototype.check=function(){this.wave=Math.max(0,Math.min(7,~~this.wave)),this.pitch=Math.max(0,Math.min(93,~~this.pitch)),this.volume=Math.max(0,Math.min(62,~~this.volume))}},function(t,i){for(var s="#$%&'()*+,-~/0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}. !",n=s.length,o={},e=0;e<s.length;e++)o[s[e]]=e;i.encodeUint13=function(t){return s[~~(t/n)]+s[t%n]},i.encodeUint6=function(t){return s[t]},i.decodeUint13=function(t,i){var s=t[i],e=t[i+1];return o[s]*n+o[e]},i.decodeUint6=function(t,i){return o[t[i]]}},function(t,i,s){var u=s(7),e=s(8),n=s(1),l=n.SAMPLE_RATE,c=n.CHUNK_LENGTH;function o(){this.oscillator=new e}(t.exports=o).prototype.generateSound=function(t){var i=t.steps;if(0===i.length)return null;var s=(t.speed+1)*c,e=i.length*s+100,n=u.createBuffer(1,e,l),o=n.getChannelData(0);this.oscillator.reset();for(var r=0,h=0;r<i.length;r++){var a=i[r];this.oscillator.setStep(t,a),this.oscillator.generate(o,h,h+s),h+=s}return this.oscillator.generateEndDamping(o,h,h+100),n}},function(t,i){var s=new window.AudioContext;t.exports=s},function(t,i,s){var e=s(9),n=s(1).SAMPLE_RATE,o=2*Math.PI,r=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];function h(){this._amp=1,this._oscPos=0,this._oscInc=0,this._oscState=1,this._oscOut=0,this._duty=0,this._prevOut=0,this.generate=this._generatePulse}(t.exports=h).prototype.reset=function(){this._oscPos=0,this._oscState=1,this._oscOut=0,this._prevOut=0},h.prototype.setStep=function(t,i){var s=t.pmin+(t.pmax-t.pmin-20)*i.pitch/93;switch(s=20+90*s/107,t.snap&&(s=Math.round(s)),this._oscInc=e.noteToFreq(s)/n,this._amp=i.volume/63,i.wave){case 0:this.generate=this._generatePulse,this._duty=.06;break;case 1:this.generate=this._generatePulse,this._duty=.12;break;case 2:this.generate=this._generatePulse,this._duty=.25;break;case 3:this.generate=this._generatePulse,this._duty=.5;break;case 4:this.generate=this._generateTriangle;break;case 5:this.generate=this._generateSine;break;case 6:this.generate=this._generateSaw,this._amp*=2;break;case 7:this.generate=this._generateNoise,this._oscInc=2.9*this._oscInc+.01}},h.prototype._generatePulse=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),e=this._oscPos>this._duty?this._amp:-this._amp,t[n]=e;this._prevOut=e},h.prototype._generateTriangle=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),e=r[~~(32*this._oscPos)]*this._amp,t[n]=e;this._prevOut=e},h.prototype._generateSine=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),e=Math.sin(this._oscPos*o)*this._amp,t[n]=e;this._prevOut=e},h.prototype._generateSaw=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++)this._oscPos+=this._oscInc,1<this._oscPos&&(this._oscPos=this._oscPos%1),e=(this._oscPos-.5)*this._amp,t[n]=e;this._prevOut=e},h.prototype._generateNoise=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++){if(this._oscPos+=this._oscInc,1<this._oscPos){this._oscPos=this._oscPos%1;var o=!(16384&this._oscState)^!(8192&this._oscState);this._oscState=32767&(this._oscState<<1|o),this._oscOut=(16384&this._oscState)>>14}e=(this._oscOut-.5)*this._amp,t[n]=e}this._prevOut=e},h.prototype.generateEndDamping=function(t,i,s){for(var e=this._prevOut,n=i;n<s;n++)e*=.98,t[n]=e}},function(t,i){for(var n=[],s=0;s<128;s++)n.push(440*Math.pow(2,(s-69)/12));i.noteToFreqTable=n,i.noteToFreq=function(t){t<0&&(t=0),127<t&&(t=127);var i=~~t,s=t-i,e=n[i];return e+s*(n[1+i]-e)}}],n.c=e,n.d=function(t,i,s){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(i,t){if(1&t&&(i=n(i)),8&t)return i;if(4&t&&"object"==o(i)&&i&&i.__esModule)return i;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var e in i)n.d(s,e,function(t){return i[t]}.bind(null,e));return s},n.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=2);function n(t){if(e[t])return e[t].exports;var i=e[t]={i:t,l:!1,exports:{}};return s[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var s,e},"object"==(void 0===s?"undefined":o(s))&&"object"==(void 0===i?"undefined":o(i))?i.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==(void 0===s?"undefined":o(s))?s.bleeper=n():e.bleeper=n()},{}],18:[function(t,i,s){"use strict";i.exports=function(t,i){var s=document.createElement("canvas");return s.width=t,s.height=i,s}},{}],19:[function(t,i,s){"use strict";var c=["A","B","X","Y","lb","rb","lt","rt","back","start","lp","rp","up","down","left","right"],e=!(!navigator||!navigator.getGamepads),p=!1,f=.2;function n(){this.available=!1,this.btn={},this.btnp={},this.btnr={},this.x=0,this.y=0,this.z=0,this.w=0,this.lt=0,this.rt=0,this._setupButtons()}n.prototype._setupButtons=function(){for(var t=0;t<c.length;t++){var i=c[t];this.btn[i]=!1,this.btnp[i]=!1,this.btnr[i]=!1}};var d=[new n,new n,new n,new n,window],o=new n;var r=e?function(){for(var t=navigator.getGamepads(),i=0;i<4;i++){var s=t[i],e=d[i];if(s){var n,o,r,h;e.available=!0,p&&(n=e.btn.right,o=e.btn.left,h=e.btn.down,r=e.btn.up);for(var a=0;a<c.length;a++){var u=c[a],l=s.buttons[a].pressed;e.btnp[u]=!e.btn[u]&&l,e.btnr[u]=e.btn[u]&&!l,e.btn[u]=l}e.x=s.axes[0],e.y=s.axes[1],e.z=s.axes[2],e.w=s.axes[3],e.lt=s.buttons[6].value,e.rt=s.buttons[7].value,p&&(e.btn.right=e.btn.right||e.x>f,e.btn.left=e.btn.left||e.x<-f,e.btn.down=e.btn.down||e.y>f,e.btn.up=e.btn.up||e.y<-f,e.btnp.right=e.btn.right&&!n,e.btnp.left=e.btn.left&&!o,e.btnp.down=e.btn.down&&!h,e.btnp.up=e.btn.up&&!r,e.btnr.right=!e.btn.right&&n,e.btnr.left=!e.btn.left&&o,e.btnr.down=!e.btn.down&&h,e.btnr.up=!e.btn.up&&r)}else e.available=!1}return d}:function(){return d};s.mapAnalogStickToDpad=function(t){p=!0,f=void 0===t?.3:t},s.update=function(){window.gamepads=r(),window.gamepad=function(){for(var t=0;t<c.length;t++){var i=c[t];o.btnp[i]=btnp[i]||d[0].btnp[i]||d[1].btnp[i]||d[2].btnp[i]||d[3].btnp[i],o.btnr[i]=btnr[i]||d[0].btnr[i]||d[1].btnr[i]||d[2].btnr[i]||d[3].btnr[i],o.btn[i]=btn[i]||d[0].btn[i]||d[1].btn[i]||d[2].btn[i]||d[3].btn[i]}return o.btn.up&&o.btn.down&&(o.btn.down=!1),o.btn.right&&o.btn.left&&(o.btn.left=!1),o}()}},{}],20:[function(t,i,s){"use strict";i.exports=function(t,i){t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],21:[function(t,i,s){"use strict";var u=null;!function n(o,r,h){function a(i,t){if(!r[i]){if(!o[i]){if(u)return u(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var e=r[i]={exports:{}};o[i][0].call(e.exports,function(t){return a(o[i][1][t]||t)},e,e.exports,n,o,r,h)}return r[i].exports}for(var u=null,t=0;t<h.length;t++)a(h[t]);return a}({1:[function(t,i,s){i.exports=function(t,i){t.prototype=Object.create(i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}},{}],2:[function(t,i,s){function e(t){this.color=0,this.steps=[],this.frozen=!1;for(var i=0;i<t;i++){var s=new n(i);this.steps.push(s)}}var n=t("./Step"),o=(i.exports=e).prototype;o.$15=function(){for(var t=null,i=this.steps.length-1;0<=i;i--){var s=this.steps[i];if(s.$1i){var e=new n(s.index);e.note=-1,e.$1g=s.$1i,e.next=t,s.next=e}else s.next=t;s.$26||(t=s)}},o.$14=function(t){this.color=t.c||0;for(var i=t.s,s=0,e=0;e<this.steps.length;e++)s=this.steps[e].$14(i,s);this.$15()}},{"./Step":4}],3:[function(t,i,s){function e(t,i){this.album=t,this.index=i,this.name="untitled",this.author="",this.infos="",this.bpm=130,this.$k=32,this.speed=4,this.groove=[],this.highlight=16,this.loop=0,this.length=0,this.tracks=[],this.effects=[],this.$t=null;for(var s=t.trackCount,e=0;e<s;e++){var n=new o(this,e);this.tracks.push(n)}}var r=t("./Pattern"),o=t("./Track");(i.exports=e).prototype.$14=function(t){this.name=t.n||"",this.author=t.a||"",this.infos=t.i||"",this.bpm=t.b,this.$k=t.l,this.speed=t.s,this.groove=t.g,this.highlight=t.h,this.loop=t.o||0,this.$t=new r(this.$k),this.$t.frozen=!0;for(var i=t.t,s=this.length=0;s<i.length;s++){var e=this.tracks[s];e.$14(i[s]),this.length=Math.max(this.length,e.sequence.length)}var n=t.e||[];this.effects=[];for(s=0;s<4;s++){var o=n[s];o?this.effects.push({id:o.i||0,params:o.p||{}}):this.effects.push(null)}}},{"./Pattern":2,"./Track":5}],4:[function(t,i,s){function a(t,i){return l[t]*h.length+l[i]}function u(t,i,s,e){var n=a(t,i);s["fx"+e]=n%c,s["fv"+e]=~~(n/c)}function e(t,i,s,e){this.id=t,this.value=i,this.x=s,this.y=e}function n(t){this.index=t,this.$26=!0,this.next=null,this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null,this.fv1=0,this.fv2=0,this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0}var o=t("../constants").$1s,r=t("./encoding"),h=r.$1v,l=r.$25,c=r.$i,p=(i.exports=n).prototype;p.$x=function(t,i){if(t!==o.$1c)if(t!==o.$1d){var s=new e(t,i,i>>4,15&i);t===o.$2s?this.$2n.push(s):this.$2o.push(s)}else this.$1i=i/256;else this.$1g=i/256},p.$1e=function(){this.$26=!(null!==this.note||null!==this.inst||null!==this.vol||null!==this.fx1||null!==this.fx2),this.$2n=[],this.$2o=[],this.$1g=0,this.$1i=0,null!==this.fx2&&this.$x(this.fx2,this.fv2),null!==this.fx1&&this.$x(this.fx1,this.fv1)},p.$14=function(t,i){this.note=null,this.inst=null,this.vol=null,this.fx1=null,this.fx2=null;var s=l[t[i++]],e=s>>1&1,n=s>>2&1,o=s>>3&1,r=s>>4&1;if(1&s){var h=s>>5&1;this.note=h?-1:a(t[i++],t[i++])}return e&&(this.inst=l[t[i++]]),n&&(this.vol=l[t[i++]]),o&&u(t[i++],t[i++],this,1),r&&u(t[i++],t[i++],this,2),this.$1e(),i}},{"../constants":13,"./encoding":6}],5:[function(t,i,s){function e(t,i){this.index=i,this.song=t,this.synthId=0,this.patterns=[],this.sequence=[]}var o=t("./Pattern"),n=(i.exports=e).prototype;n.$2=function(t){var i=this.song.length;if(i<=t){var s=this.song.loop;t=(t-s)%(i-s)+s}if(t>this.sequence.length)return this.song.$t;var e=this.sequence[t];return-1===e?this.song.$t:this.patterns[e]},n.$js=function(){return this.song.album.instruments[this.synthId]},n.$14=function(t){this.synthId=t.y||0,this.sequence=t.s,this.patterns=[];for(var i=t.p,s=this.song.$k,e=0;e<i.length;e++){var n=new o(s);n.$14(i[e]),this.patterns.push(n)}}},{"./Pattern":2}],6:[function(t,i,s){for(var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&'()*+,-~/:;<=>?@[]^_`{|}. !",n={},o=0;o<e.length;o++)n[e[o]]=o;s.$1v=e,s.$25=n,s.$i=32},{}],7:[function(t,i,s){function e(){this.version=0,this.trackCount=8,this.instruments={},this.songs=[],this.samples=[],this.path=""}var o=t("./Song");(i.exports=e).prototype.$14=function(t){var i=t.v||0,s=t.s||[];this.version=i,this.trackCount=t.t,this.songs=[],this.instruments=t.i,this.samples=t.a;for(var e=0;e<s.length;e++){var n=new o(this,e);n.$14(s[e]),this.songs.push(n)}}},{"./Song":3}],8:[function(t,i,s){function e(t,i){this.index=t,this.sequencer=i,this.effector=null,this.params=null,this.buffL=new Float32Array(r),this.buffR=new Float32Array(r)}var n=t("../constants"),o=t("../synths").getEffector,r=n.$h,h=(i.exports=e).prototype;h.loadEffect=function(t){if(t){this.effector=o(t.id,this.sequencer);var i=t.params;for(var s in i)this.effector[s]=i[s]}else this.effector=null},h.clearBuffer=function(){if(this.effector)for(var t=0;t<r;t++)this.buffL[t]=0,this.buffR[t]=0},h.process=function(t){this.effector&&this.effector.process(this.buffL,this.buffR,this.sequencer.buffL,this.sequencer.buffR,t)}},{"../constants":13,"../synths":27}],9:[function(t,i,s){function e(t,i){this.index=t,this.sequencer=i,this.synth=null,this.data=null,this.$u=0,this.$1w=null,this.$1f=0,this.output=this.sequencer}var n=t("../synths").getSynth,o=t("../constants").$1s,r=(i.exports=e).prototype;r.restart=function(t){this.synth&&(this.synth.$27(),this.$u=t||0,this.$1w=this.data.$2(this.$u).steps[0],this.$3())},r.loadData=function(t){this.data=t,this.synth=n(t.synthId,this.sequencer),this.output=this.sequencer,this.restart()},r.$y=function(t){if(t){null!==t.vol&&this.synth.$1q(t.vol),null!==t.inst&&this.synth.$n(this.sequencer.$j(this.index,t.inst));for(var i=0;i<t.$2n.length;i++){var s=t.$2n[i];this.synth.$2t(s.id,s.value,s.x,s.y)}null!==t.note&&(-1===t.note?this.synth.$27():this.synth.$2m(t.note));for(i=0;i<t.$2o.length;i++){(s=t.$2o[i]).id===o.$12?this.output=this.sequencer.effects[s.value]||this.sequencer:this.synth.$2t(s.id,s.value,s.x,s.y)}}},r.$3=function(){var t=this.sequencer,i=this.$1w,s=t.$w[i.index%t.$w.length];this.$1f=this.$u*t.$1y+(i.index+i.$1g)*t.$1z+s},r.$b=function(){this.$1w=this.$1w.next,this.$1w||(this.$u+=1,this.$1w=this.data.$2(this.$u).steps[0]),this.$3()},r.$1x=function(t){if(this.synth){var i=this.sequencer.t;this.$1f<=i&&(this.$y(this.$1w),this.$b());for(var s=0,e=i+t;this.$1f<e;){var n=~~(this.$1f-i);n<0&&(n=0),this.synth.$1x(this.output.buffL,this.output.buffR,s,n),s=n,this.$y(this.$1w),this.$b()}this.synth.$1x(this.output.buffL,this.output.buffR,s,t)}}},{"../constants":13,"../synths":27}],10:[function(t,i,s){function e(){this.tracks=[],this.effects=[],this.buffers=[],this.album=null,this.song=null,this.$1z=0,this.$1y=0,this.$w=[0],this.synth=null,this.t=0,this.stopped=!0,this.$1r=null,this.$16=null,this.buffL=null,this.buffR=null,this.effects.push(this);for(var t=0;t<4;t++)this.effects.push(new a(t,this));this.$4=[]}var n=t("./loadAudioBuffer"),o=t("../constants"),r=t("../audioContext"),h=t("./Track"),a=t("./Effect"),u=o.$11,l=o.$h,c=(i.exports=e).prototype;c.$e=function(){if(!this.$16){this.$1r=r.createGain(),this.$1r.connect(r.destination),this.$1r.gain.value=.5;var t=r.createScriptProcessor(l,0,2);t.onaudioprocess=this.onAudioProcess.bind(this),t.connect(this.$1r),this.$16=t}},c.onAudioProcess=function(t){var i,s=t.outputBuffer,e=this.buffL=s.getChannelData(0),n=this.buffR=s.getChannelData(1);for(i=0;i<l;i++)e[i]=0,n[i]=0;for(i=0;i<this.$4.length;i++)this.$4[i].clearBuffer();if(!this.stopped){for(i=0;i<this.tracks.length;i++)this.tracks[i].$1x(l);for(i=0;i<this.$4.length;i++)this.$4[i].process(l);this.t+=l}},c.$13=function(){for(var t=0;t<this.tracks.length;t++){var i=this.tracks[t].synth;i&&i.reset()}},c.play=function(){this.$q(0)},c.$q=function(t){if(this.song){this.t=t*this.$1y;for(var i=0;i<this.tracks.length;i++)this.tracks[i].restart(t);this.stopped=!1}},c.stop=function(){this.stopped=!0,this.$13()},c.$j=function(t,i){var s=this.song.tracks[t].synthId,e=this.album.instruments[s];return e[i%e.length]},c.loadAlbum=function(t,i){this.stop(),this.album=t,this.song=null,this.tracks=[];for(var s=t.trackCount,e=0;e<s;e++){var n=new h(e,this);this.tracks.push(n)}var o=t.samples;this.buffers=[];for(e=0;e<o.length;e++)this.buffers.push(null),this.loadAudioBufferInIndex(o[e],e)},c.loadAudioBufferInIndex=function(t,s){var e=this.buffers;n(t,function(t,i){return t?void console.error(t):void(e[s]=i.getChannelData(0))})},c.$d=function(t){if(!this.album)return console.error("No album loaded");var i=this.album.songs[t];if(!i)return console.error("No song at index");this.song=i,this.$1b();for(var s=0;s<this.tracks.length;s++){this.tracks[s].loadData(i.tracks[s])}for(s=1;s<this.effects.length;s++){this.effects[s].loadEffect(i.effects[s-1])}this.$p(),this.synth=this.tracks[0].synth,this.$13()},c.$p=function(){this.$4=[];for(var t=1;t<this.effects.length;t++){var i=this.effects[t];i.effector&&this.$4.push(i)}},c.$1b=function(){this.$1z=60*u/this.song.bpm/this.song.speed,this.$1y=this.$1z*this.song.$k,this.$v()},c.$v=function(){this.$w=[0];var t=this.song.groove;if(t&&!(t.length<2)){for(var i=0,s=0;s<t.length;s++)i+=t[s];var e=i/t.length,n=t[0];for(s=1;s<t.length;s++){var o=(n-e*s)/e*this.$1z;this.$w.push(o),n+=t[s]}}}},{"../audioContext":12,"../constants":13,"./Effect":8,"./Track":9,"./loadAudioBuffer":11}],11:[function(t,i,s){function e(t){this.uri=t,this.buffer=null,this.error=null,this.loading=!1,this.onLoad=[]}var n=t("../audioContext"),o={};e.prototype.load=function(t){return this.error||this.buffer?t(this.error,this.buffer):(this.onLoad.push(t),void(this.loading||this.initiateLoad()))},e.prototype.initiateLoad=function(){this.loading=!0;var t=new XMLHttpRequest;t.responseType="arraybuffer";var i=this;t.onreadystatechange=function(){if(4==~~t.readyState)return 200!=~~t.status&&0!=~~t.status?i.completeLoad("xhrError:"+t.status):void n.decodeAudioData(t.response,function(t){return i.completeLoad(null,t)},i.completeLoad.bind(i))},t.open("GET",this.uri,!0),t.send()},e.prototype.completeLoad=function(t,i){this.buffer=i,this.error=t;for(var s=0;s<this.onLoad.length;s++)this.onLoad[s](t,i);this.onLoad=[]},i.exports=function(t,i){var s=o[t];(s=s||(o[t]=new e(t))).load(i)}},{"../audioContext":12}],12:[function(t,i,s){var e=new window.AudioContext;i.exports=e},{}],13:[function(t,i,s){s.$h=2048,s.$11=44100,s.$r=s.$11/64,s.$1s={$1t:0,$23:1,$24:2,$2v:3,$2s:4,$8:5,$g:6,$1c:7,$1d:8,$12:9},s.$1u=1,s.$5=2,s.$9=32,s.$6=4,s.TAU=2*Math.PI},{}],14:[function(t,i,s){for(var n=[],e=0;e<128;e++)n.push((o=e,440*Math.pow(2,(o-69)/12)));var o;s.$a=n,s.$1h=function(t){t<0&&(t=0),127<t&&(t=127);var i=~~t,s=t-i,e=n[i];return e+s*(n[1+i]-e)}},{}],15:[function(t,i,s){var e=t("./audioContext"),n=t("./Album"),o=t("./Sequencer"),r=new n,h=new o;h.$e();var a={};u={context:e,output:h.$1r,loadData:function(t){r.$14(t),h.loadAlbum(r),a={};for(var i=0;i<r.songs.length;i++){var s=r.songs[i];a[s.name]=i}},playSong:function(t){a[t]&&(t=a[t]),h.$d(~~t),h.play()},stop:function(){h.stop()},$1q:function(t){h.$1r.gain.value=Math.max(0,Math.min(t,1))}}},{"./Album":7,"./Sequencer":10,"./audioContext":12}],16:[function(t,i,s){function e(){this._time=11025,this.f=.4,this.c=.6,this.$2k=new Float32Array(h),this.$21=0,this._filterState=0}var h=44100,n=(i.exports=e).prototype;e.getDefaultParams=function(){return{t:.25,f:.4,c:.6}},n.process=function(t,i,s,e,n){for(var o=0;o<n;o++){var r=this.$2k[this.$21]*this.f;this._filterState=r*this.c+this._filterState*(1-this.c),r=t[o]+this._filterState,this.$2k[(this.$21+this._time)%h]=r,this.$21+=1,this.$21>=h&&(this.$21=0),s[o]+=r,e[o]+=r}},Object.defineProperty(n,"t",{set:function(t){this._time=Math.max(100,~~(t*h))}})},{}],17:[function(t,i,s){function e(t){this.synth=t,this.$2p=0,this.$2l=d,this.$2c=0,this.out=0,this.instrument=null}function n(){this.note=0,this.volume=0,this.playing=!1,this.$2q=0,this.$m=0,this.$2w=0,this.instrument=null,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this._damping=!1,this._dampVal=0,this._lastOut=0,this.$1j=[new e(this),new e(this),new e(this),new e(this)],this.$n(this.$1())}var o=t("../constants"),r=t("../noteUtils"),h=o.$1s,a=o.$11,u=a/60,l=(o.$1u,o.TAU),c=o.$5,p=o.$6,f=o.$9,d=0,$=e.prototype;$.$n=function(t){this.instrument=t},$.$28=function(){this.$2c=0,this.$2l=4},$.$1x=function(){switch(this.$2l){case d:return;case 2:break;case 4:this.$2c+=this.instrument.a/64,1<=this.$2c&&(this.$2c=1,this.$2l=3);break;case 3:this.$2c-=this.instrument.d/64,this.$2c<=this.instrument.s&&(this.$2c=this.instrument.s,1===this.synth.instrument.c?this.$2l=1:this.$2l=2);break;case 1:this.$2c-=this.instrument.r/64,this.$2c<=0&&(this.$2c=0,this.$2l=d,this.out=0)}var t=this.synth.$1j,i=this.instrument.c,s=0;s+=i[0]*t[0].out,s+=i[1]*t[1].out,s+=i[2]*t[2].out,s+=i[3]*t[3].out,this.$2p+=this.synth.$2q*this.instrument.m,1<=this.$2p&&(this.$2p=this.$2p%1),this.out=this.$2c*Math.sin(l*(this.$2p+s))};var v=(i.exports=n).prototype;v.$1=function(){return{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}},v.$n=function(t){this.instrument=t,this.$1j[0].$n(t.o[0]),this.$1j[1].$n(t.o[1]),this.$1j[2].$n(t.o[2]),this.$1j[3].$n(t.o[3])},v.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},v.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/c,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.playing=!0,this.$m=0,this.$2d=0,this.$1j[0].$28(),this.$1j[1].$28(),this.$1j[2].$28(),this.$1j[3].$28(),this.$17(),this._damping=!1},v.$27=function(){this.playing&&(0===this.instrument.c?(this.$1j[0].$2l=1,this.$1j[1].$2l=1,this.$1j[2].$2l=1,this.$1j[3].$2l=1):(this.playing=!1,this._damping=!0,this._dampVal=this._lastOut))},v.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*l));var i=this.note+this.instrument.p+this.$20+this.$1o+t;this.$2q=r.$1h(i)/a},v.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*l)+1)),this.$2w=this.volume*t},v.$c=function(){var t=!1,i=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],i=!0),0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),i&&this.$17(),t&&this.$18()},v.$1q=function(t){this.volume=t/40,this.$18()},v.$2t=function(t,i,s,e){var n=!1,o=!1;switch(t){case h.$1t:this.$20=0,(this.$2d=0)===i?(this.$19=!1,n=!(this.$1l=null)):(this.$19=!0,this.$1l=0===e?[0,s]:[0,s,e]);break;case h.$24:this.$2f=s/64,this.$2g=e/16,0===e&&(n=!0);break;case h.$23:this.$2h=s/64,this.$2i=e/f,o=!0;break;case h.$2s:this.$1m=i/p;break;case h.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(s+1)/c;break;case h.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(s+1)/c}n&&this.$17(),o&&this.$18()},v.$1x=function(t,i,s,e){if(this._damping){for(var n=s;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return void(this._damping=!1)}else if(this.playing){for(n=s;n<e;n++){if(++this.$m>=u){if(this.$m-=u,this.$1j[0].$2l===d&&this.$1j[1].$2l===d&&this.$1j[2].$2l===d&&this.$1j[3].$2l===d)return void(this.playing=!1);this.$c()}this.$1j[0].$1x(),this.$1j[1].$1x(),this.$1j[2].$1x(),this.$1j[3].$1x();var o=0;o+=this.$1j[0].instrument.v*this.$1j[0].out,o+=this.$1j[1].instrument.v*this.$1j[1].out,o+=this.$1j[2].instrument.v*this.$1j[2].out,o+=this.$1j[3].instrument.v*this.$1j[3].out,o*=this.$2w,t[n]+=o,i[n]+=o}this._lastOut=o}}},{"../constants":13,"../noteUtils":14}],18:[function(t,i,s){function e(t){this.feedback=0,this.$2k=new Float32Array(t),this._bufsize=t,this._index=0,this._filtered=0,this._damp1=0,this._damp2=0}function n(t){this.$2k=new Float32Array(t),this._bufsize=t,this._index=0}function o(){this._roomSize=0,this._roomSize1=0,this._damp=0,this._damp1=0,this._wet=0,this._wet1=0,this._wet2=0,this._dry=0,this._width=0,this.combL=[],this.combR=[],this.allpassL=[],this.allpassR=[];for(var t=0;t<8;t++)this.combL.push(new e(a[t])),this.combR.push(new e(a[t]+23));for(var i=0;i<4;i++)this.allpassL.push(new n(u[i])),this.allpassR.push(new n(u[i]+23))}var r=e.prototype;r.setDamp=function(t){this._damp1=t,this._damp2=1-t},r.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},r.process=function(t){var i=this.$2k[this._index];return this._filtered=i*this._damp2+this._filtered*this._damp1,this.$2k[this._index]=t+this._filtered*this.feedback,++this._index>=this._bufsize&&(this._index=0),i};var h=n.prototype;h.mute=function(){for(var t=0;t<this._bufsize;t++)this.$2k[t]=0},h.process=function(t){var i=this.$2k[this._index];return this.$2k[this._index]=t+.5*i,++this._index>=this._bufsize&&(this._index=0),i-t};var a=[1116,1188,1277,1356,1422,1491,1557,1617],u=[556,441,341,225],l=(i.exports=o).prototype;o.getDefaultParams=function(){return{d:.8,w:.3,z:.8,a:.5,i:.8}},l.process=function(t,i,s,e,n){for(var o,r=0;r<n;r++){var h=0,a=0;for(o=0;o<8;o++)h+=this.combL[o].process(t[r]),a+=this.combR[o].process(i[r]);for(o=0;o<4;o++)h=this.allpassL[o].process(h),a=this.allpassR[o].process(a);s[r]+=h*this._wet1+a*this._wet2+t[r]*this._dry,e[r]+=a*this._wet1+h*this._wet2+i[r]*this._dry}},l.mute=function(){for(var t=0;t<8;t++)this.combL[t].mute(),this.combR[t].mute();for(t=0;t<4;t++)this.allpassL[t].mute(),this.allpassR[t].mute()},l.update=function(){this._wet1=this._wet*(this._width/2+.5),this._wet2=this._wet*((1-this._width)/2),this._roomSize1=this._roomSize,this._damp1=this._damp;for(var t=0;t<8;t++)this.combL[t].feedback=this._roomSize1,this.combR[t].feedback=this._roomSize1,this.combL[t].setDamp(this._damp1),this.combR[t].setDamp(this._damp1)},Object.defineProperty(l,"d",{set:function(t){this._dry=+t}}),Object.defineProperty(l,"w",{set:function(t){this._wet=.06*t,this.update()}}),Object.defineProperty(l,"z",{set:function(t){this._roomSize=.28*t+.7,this.update()}}),Object.defineProperty(l,"a",{set:function(t){this._damp=.4*t,this.update()}}),Object.defineProperty(l,"i",{set:function(t){this._width=t,this.update()}})},{}],19:[function(t,i,s){function e(){this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=1.4,this.$29=0,this.$2a=0,this.$1k=1,this.$2b=0,this.$2u=l[0],this.$2j=0,this.$2h=0,this.$2i=0,this.$1a=new o(1,15),this.$o=new o(0,1),this.$10=new o(0,1)}var n=t("../constants"),o=t("./TableEnvelope"),r=n.$1s,h=n.$11/60,a=2*Math.PI,u=[.01,.02,.04,.053,.08,.105,.15,.2,.25,.3,.35,.4,.45,.5,.7,.9],l=[8192,256,6144,4480],c=(i.exports=e).prototype;c.$1=function(){return{n:""}},c.$n=function(t){this.$1a.set(t.a),this.$o.set(t.p),this.$10.set(t.d)},c.reset=function(){this.$27(),this.$1q(15),this.$29=0,this.$2i=0,this.$17(),this.$18()},c.$2m=function(t){this.note=t,this.$m=0,this.$1a.$2r(),this.$o.$2r(),this.$10.$2r(),this.$17(),this.$18(),this.playing=!0},c.$27=function(){this.playing=!1},c.$1q=function(t){this.volume=t/30,this.$18()},c.$2t=function(t,i,s,e){var n=!1;switch(t){case r.$23:this.$2h=s/64,this.$2i=e/32,n=!0;break;case r.$2v:this.$2u=l[i%l.length]}n&&this.$18()},c.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*a)+1)),this.$2w=1.4*this.volume*t,this.$2w*=this.$1a.value},c.$17=function(){var t=~~(this.note+this.$o.value);this.$2a=u[t%16]},c.$c=function(){var t=!1,i=!1;0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(i=!0),this.$10.enabled&&this.$10.clock()&&(this.$2u=l[~~this.$10.value%l.length]),i&&this.$17(),t&&this.$18()},c.$1x=function(t,i,s,e){if(this.playing)for(var n=s;n<e;n++){if(++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29){this.$29=this.$29%1;var o=!(16384&this.$1k)^!(this.$1k&this.$2u);this.$1k=32767&(this.$1k<<1|o),this.$2b=(16384&this.$1k)>>14}var r=(this.$2b-.5)*this.$2w;t[n]+=r,i[n]+=r}}},{"../constants":13,"./TableEnvelope":25}],20:[function(t,i,s){function e(){r.call(this),this.$2w=.25,this.$2u=.25,this.$10=new o(0,1)}for(var n=t("../constants"),o=t("./TableEnvelope"),r=t("./SimpleOscillator"),h=t("pixelbox/inherits"),a=n.$11/60,u=[1/8,.25,.5,.75],l=1;l<63;l++)u.push(l/64);h(e,r);var c=(i.exports=e).prototype;c.$n=function(t){r.prototype.$n.call(this,t),this.$10.set(t.d)},c.$2m=function(t){r.prototype.$2m.call(this,t),this.$10.$2r()},c.$1q=function(t){this.volume=t/60,this.$18()},c._updateDuty=function(t){this.$2u=u[t%u.length]},c.$c=function(){r.prototype.$c.call(this),this.$10.enabled&&this.$10.clock()&&(this.$2u=u[~~this.$10.value])},c.$1x=function(t,i,s,e){if(this.playing)for(var n=s;n<e;n++){++this.$m>=a&&(this.$m-=a,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=this.$29>this.$2u?this.$2w:-this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"./TableEnvelope":25,"pixelbox/inherits":1}],21:[function(t,i,s){function e(){n.call(this),this._damping=!1,this._dampVal=0}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60,a=[0,.12,.25,.37,.5,.62,.75,.87,.87,.75,.62,.5,.37,.25,.12,0,-.12,-.25,-.37,-.5,-.62,-.75,-.87,-1,-1,-.87,-.75,-.62,-.5,-.37,-.25,-.12];r(e,n);var u=(i.exports=e).prototype;u.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},u.$27=function(){this.playing&&(this._damping=!0,this._dampVal=a[~~(32*this.$29)]*this.$2w),this.playing=!1},u.$1x=function(t,i,s,e){if(this._damping){for(var n=s;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(n=s;n<e;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=a[~~(32*this.$29)]*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],22:[function(t,i,s){function e(t){this._sequencer=t,this.$2k=null,this._instrument=this.$1(),this.note=0,this.volume=0,this.playing=!1,this.$21=0,this.$22=0,this.$f=0,this.$m=0,this.$2w=1,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$2l=0,this.$2c=0}var n=t("../constants"),o=t("../noteUtils"),r=(n.$1u,n.$1s),h=n.$11/60,a=o.$a[60],u=n.TAU,l=n.$5,c=n.$6,p=n.$9,f=(i.exports=e).prototype;f.$1=function(){return{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}},f.$n=function(t){var i=(this._instrument=t).a||0;this.$2k=this._sequencer.buffers[i],this.$21=t.s},f.reset=function(){this.playing=!1,this.$1q(15),this.$17(),this.$18()},f.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/l,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$21=this._instrument.s,this.$17(),this.$18(),this.$2c=0,this.$2l=4,this.$2k&&(this.playing=!0)},f.$27=function(){0===this._instrument.v[4]?this.$2l=1:this.playing=!1},f.$1q=function(t){this.volume=t/20,this.$18()},f.$2t=function(t,i,s,e){var n=!1,o=!1;switch(t){case r.$24:this.$2f=s/64,this.$2g=e/16,0===e&&(n=!0);break;case r.$23:this.$2h=s/64,this.$2i=e/p,o=!0;break;case r.$2s:this.$1m=i/c;break;case r.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(s+1)/l;break;case r.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(s+1)/l}n&&this.$17(),o&&this.$18()},f.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=this.volume*t},f.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*u));var i=this.note+this._instrument.p+this.$1o+t;this.$22=o.$1h(i)/a},f.$c=function(){var t=!1,i=!1;0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),i&&this.$17(),t&&this.$18()},f.$7=function(){if(0!==this.$2l){var t=this._instrument.v;switch(this.$2l){case 2:break;case 4:this.$2c+=t[0],1<=this.$2c&&(this.$2c=1,this.$2l=3);break;case 3:this.$2c-=t[1],this.$2c<=t[2]&&(this.$2c=t[2],1===t[4]?this.$2l=1:this.$2l=2);break;case 1:this.$2c-=t[3],this.$2c<=0&&(this.$2c=0,this.$2l=0,this.playing=!1)}}},f.$1x=function(t,i,s,e){if(this.playing)for(var n=s;n<e;n++){if(64<=++this.$f&&(this.$f=0,this.$7()),++this.$m>=h&&(this.$m-=h,this.$c()),this.$21+=this.$22,this.$21>=this._instrument.e){if(0===this._instrument.l)return void(this.playing=!1);this.$21-=this._instrument.l}var o=this.$2k[~~this.$21]*this.$2c*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"../noteUtils":14}],23:[function(t,i,s){function e(){n.call(this)}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60;r(e,n),(i.exports=e).prototype.$1x=function(t,i,s,e){if(this.playing)for(var n=s;n<e;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=(this.$29-.5)*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],24:[function(t,i,s){function e(){this._instrument=null,this.note=0,this.volume=0,this.playing=!1,this.$m=0,this.$2w=l,this.$29=0,this.$2a=0,this.$1m=null,this.$1p=0,this.$1n=0,this.$1o=0,this.$2e=0,this.$2f=0,this.$2g=0,this.$2j=0,this.$2h=0,this.$2i=0,this.$19=!1,this.$2d=0,this.$1l=null,this.$20=0,this.$1a=new r(1,15),this.$o=new r(0,1),this.$z=new r(0,16)}var n=t("../constants"),o=t("../noteUtils"),r=t("./TableEnvelope"),h=n.$1s,a=n.$11,u=n.TAU,l=n.$1u,c=n.$5,p=n.$6,f=n.$9,d=(i.exports=e).prototype;d.$1=function(){return{n:""}},d.$n=function(t){this._instrument=t,this.$1a.set(t.a),this.$o.set(t.p),this.$z.set(t.t)},d.reset=function(){this.$27(),this.$1q(15),this.$19=!1,this.$1l=null,this.$20=0,this.$2g=0,this.$2i=0,this.$17(),this.$18()},d.$2m=function(t){null!==this.$1m?(this.note+=this.$1n,this.$1o=0,this.$1n=t-this.note,this.$1p=this.$1n/(this.$1m+1)/c,this.$1m=null):(this.note=t,this.$1n=0,this.$1p=0,this.$1o=0),this.$m=0,this.$2d=0,this.$1a.$2r(),this.$o.$2r(),this.$z.$2r(),this.$17(),this.$18(),this.playing=!0},d.$27=function(){this.playing=!1,this.$1m=null},d.$1q=function(t){this.volume=t/30,this.$18()},d.$2t=function(t,i,s,e){var n=!1,o=!1;switch(t){case h.$1t:this.$20=0,(this.$2d=0)===i?(this.$19=!1,n=!(this.$1l=null)):(this.$19=!0,this.$1l=0===e?[0,s]:[0,s,e]);break;case h.$24:this.$2f=s/64,this.$2g=e/16,0===e&&(n=!0);break;case h.$23:this.$2h=s/64,this.$2i=e/f,o=!0;break;case h.$2s:this.$1m=i/p;break;case h.$g:this.note+=this.$1n,this.$1o=0,this.$1n=e,this.$1p=e/(s+1)/c;break;case h.$8:this.note+=this.$1n,this.$1o=0,this.$1n=-e,this.$1p=-e/(s+1)/c;break;case h.$2v:this._updateDuty(i)}n&&this.$17(),o&&this.$18()},d._updateDuty=function(t){},d.$18=function(){var t=1;0<this.$2h&&(t=1-this.$2i*(Math.sin(this.$2j*u)+1)),this.$2w=l*this.volume*t,this.$2w*=this.$1a.value},d.$17=function(){var t=0;0<this.$2f&&(t=this.$2g*Math.sin(this.$2e*u));var i=this.note+this.$20+this.$1o+this.$o.value+this.$z.value+t;this.$2a=o.$1h(i)/a},d.$c=function(){var t=!1,i=!1;this.$19&&(this.$2d=(this.$2d+1)%this.$1l.length,this.$20=this.$1l[this.$2d],i=!0),0!==this.$1p&&(this.$1o+=this.$1p,i=!0,(0<this.$1p&&this.$1o>=this.$1n||this.$1p<0&&this.$1o<=this.$1n)&&(this.$1o=this.$1n,this.$1p=0)),0<this.$2f&&(this.$2e+=this.$2f,1<this.$2e&&--this.$2e,i=!0),0<this.$2h&&(this.$2j+=this.$2h,1<this.$2j&&--this.$2j,t=!0),this.$1a.enabled&&this.$1a.clock()&&(t=!0),this.$o.enabled&&this.$o.clock()&&(i=!0),this.$z.enabled&&this.$z.clock()&&(i=!0),i&&this.$17(),t&&this.$18()},d.$1x=function(t,i,s,e){}},{"../constants":13,"../noteUtils":14,"./TableEnvelope":25}],25:[function(t,i,s){function e(t,i){this._playing=!1,this._pos=0,this.min=t,this.max=i,this.data=null,this.table=null,this.enabled=!1,this.value=this.min}var n=(i.exports=e).prototype;n.set=function(t){if(!t)return this.enabled=!1,this.data=null,this.table=null,void(this.value=this.min);var i=t.t||null;this.data=t,this.enabled=i&&i.length&&!0,this.table=i,this.value=i?i[0]/this.max:this.min},n.clock=function(){return!!this._playing&&(this._pos+=1,this._pos>=this.table.length&&(0===this.data.l?(this._pos=this.table.length-1,this._playing=!1):this._pos-=this.data.l),this.value=this.table[this._pos]/this.max,!0)},n.$2r=function(){this.enabled&&(this._playing=!0,this._pos=0,this.value=this.table[0]/this.max)}},{}],26:[function(t,i,s){function e(){n.call(this),this._damping=!1,this._dampVal=0,this.$n(this.$1())}var n=t("./SimpleOscillator"),o=t("../constants"),r=t("pixelbox/inherits"),h=o.$11/60;r(e,n);var a=(i.exports=e).prototype;a.$1=function(){return{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}},a.$2m=function(t){n.prototype.$2m.call(this,t),this._damping=!1},a.$27=function(){this.playing&&(this._damping=!0,this._dampVal=this._instrument.w.t[~~(32*this.$29)]*this.$2w),this.playing=!1},a.$1q=function(t){this.volume=t/256,this.$18()},a.$1x=function(t,i,s,e){if(this._damping){for(var n=s;n<e;n++)if(this._dampVal*=.98,t[n]+=this._dampVal,i[n]+=this._dampVal,-.01<this._dampVal&&this._dampVal<.01)return this._damping=!1,void(this.$29=0)}else if(this.playing)for(n=s;n<e;n++){++this.$m>=h&&(this.$m-=h,this.$c()),this.$29+=this.$2a,1<this.$29&&(this.$29=this.$29%1);var o=this._instrument.w.t[~~(32*this.$29)]*this.$2w;t[n]+=o,i[n]+=o}}},{"../constants":13,"./SimpleOscillator":24,"pixelbox/inherits":1}],27:[function(t,i,s){var e=t("./NesPulse"),n=t("./NesNoise"),o=t("./NesTriangle"),r=t("./Wavetable"),h=t("./Sawtooth"),a=t("./Sampler"),u=t("./FM"),l=t("./FreeVerb"),c=t("./Delay"),p=[null,e,o,n,h,r,a,u,null,null],f=[null,l,c];s.getSynth=function(t,i){if(!t)return null;var s=p[t];return s?new s(i):null},s.getEffector=function(t,i){if(!t)return null;var s=f[t];return s?new s:null},s.$s=f},{"./Delay":16,"./FM":17,"./FreeVerb":18,"./NesNoise":19,"./NesPulse":20,"./NesTriangle":21,"./Sampler":22,"./Sawtooth":23,"./Wavetable":26}]},{},[15]),i.exports=u},{}],22:[function(t,i,s){i.exports={dat:{palette:null,tilesheet:null,bleeper:{_type:"Bleeper program",v:1,s:[{n:"damage",i:[6,0,127,0],s:"';U'AU'HU'PU'VU'[U'_U'aU'dU'kU'nU'qU'sU'uU'xU'yU'{U'{U'yU'rU'jU'bU'XU'PU'LU'FU'AU'=U'8U'4U'1U'/U"},{n:"death",i:[40,0,127,0],s:"%XV&YU#XS&VQ%XP&VO#TM&WL%XK&TI#TG&UG%VE&ZD#RC&VB%T@&X>#M=&Y<%T:&X8#O6&W5%U4&V3#L1&U/%N-&W*#K&&Q#"},{n:"pickup",i:[5,0,127,0],s:"(%U'%U($U'&U('U')U(*U'+U(,U'-U(0U'3U(4U'6U(8U':U(<U'=U(@U'BU(DU'FU(HU'JU(LU'PU(RU'VU(YU'^U(bU'gU"},{n:"dmg2",i:[1,0,127,0],s:"#[)#[+#Z-#Z/#Z2#Z4#Z7#Y:#Y<#X>#Y@#XB#XD#XF#XH#XK#XM#XN#WP#VQ#VS#VS#VR#VN#VF#V?#V=#V;#V:#V:#V7#X5"},{n:"coin",i:[2,69,108,0],s:"(FU(BU(FU(AU(FU(AU(FU(@U(?U(8U(9U(9U(9U(:U(:U(;U(=U(>U(GU(?U(@U(BU(DU(GU(JU(NU(RU(WU(]U(jU(|U0$U"}]},maps:{_type:"maps",maps:[{w:16,h:16,name:"map",sheet:"tilesheet",data:"~v|:#g48|8~h&N#h#d|0#e#d|0#f&N#d|8#f&N#d|2#h#d|/#f&N#d&M#d|~&L#d|1#f&N#d|-#h#d|3#e#f6!~g|8+ 4H4G|871&^~x|8#u&^~x&`|,~x|5#u&^~x&`|,~x|5#u&^~x&`~x|6#u&^~x&`~x|6#u&^~x&`~x|6#u~w~v|8#v"}]},patatracker:{_type:"Patatracker album",t:8,v:0,a:[],i:{1:[{n:""}],2:[{n:""}],3:[{n:""}],4:[{n:""}],5:[{n:"",w:{t:[0,1,2,3,4,5,6,7,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-7,-6,-5,-4,-3,-2,-1]}}],6:[{n:"",a:0,s:0,e:0,l:0,p:0,v:[1,1,1,1,0]}],7:[{n:"",l:{},p:0,c:1,o:[{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:0},{m:1,a:.25,d:.00225,s:.5,r:.00225,c:[0,0,0,0],v:1}]}]},s:[{n:"bg",a:"blearn",i:"",b:130,l:32,s:4,g:[],h:16,o:0,e:[0,0,0,0],t:[{y:1,p:[{s:"00000000000000000000000000000000"},{s:"50M9010Q010T010M0x000000010Mx00000000000000"},{s:"10M010P010T010M0x000000010Ax00000000000000"},{s:"10M010Q010T010M0x000000010Mx00000000000000"},{s:"10M010P010T010M0x000000010Ax00000000000000"},{s:"10M010Q010T010M010Q010T0x00010Mx00000010Mx000000"},{s:"10M010P010T010M010P010T0x00010Ax00000010Ax000000"},{s:"10M010Q010T010M010Q010T0x00010Mx00000010Mx000000"},{s:"10M010P010T010M010P010T0x00010Ax00000010Ax000000"}],s:[1,2,3,4,5,6,7,8]},{y:1,p:[{s:"00000000000000000000000000000000"}],s:[-1,-1,-1,-1,-1,-1,-1,-1]},{y:2,p:[{s:"00000000000000000000000000000000"},{s:"d0M9oEx8oEx90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx90MoEx8oEx90MoEx90MoEx90MoEx90MoEx90MoEx"},{s:"90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x90Mi`x8i`x90Mi`x90Mi`x90Mi`x90Mi`x90Mi`x"},{s:"90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx90MoEx8oEx90MoEx90MoEx90MoEx90MoEx90MoEx"},{s:"90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x90Mi`x8i`x90Mi`x90Mi`x90Mi`x90Mi`x90Mi`x"},{s:"90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx90MoEx90MoEx90MoEx90MoEx8oEx90MoEx90MoEx"},{s:"90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x90Mi`x90Mi`x90Mi`x90Mi`x8i`x90Mi`x90Mi`x"},{s:"90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx8oEx90MoEx90MoEx90MoEx90MoEx90MoEx8oEx90MoEx90MoEx"},{s:"90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x8i`x90Mi`x90Mi`x90Mi`x90Mi`x90Mi`x8i`x90Mi`x90Mi`x"}],s:[1,2,3,4,5,6,7,8]},{y:3,p:[{s:"50M5x000000000010Yx10'x0000000000000000"},{s:"10Mx000000000010Yx10'x00000000000010|x00"},{s:"10Mx000000000010Yx10'x0000000000000000"},{s:"10Mx000000000010Yx10'x00000000000010|x00"},{s:"10Mx000000000010Yx10'x0000000000000000"},{s:"10Mx000000000010Yx10'x00000000000010|x00"},{s:"10Mx000000000010Yx10'x0000000000000000"},{s:"10Mx000000000010Yx10'x00000000000010|x00"}],s:[0,1,2,3,4,5,6,7]},{y:4,p:[{s:"010Mx10Qx10Tx0000000000000000000000000"},{s:"010Mx10Px10Tx0000000000000000000000000"},{s:"010Mx10Qx10Tx10Mx10Qx10Tx0000000000000000000"},{s:"010Mx10Px10Tx10Mx10Px10Tx0000000000000000000"},{s:"010Mx10Qx10Tx10Mx10Qx10Tx0000000000000000000"},{s:"010Mx10Px10Tx10Mx10Px10Tx0000000000000000000"},{s:"490000000000000000000000000000000"}],s:[6,-1,0,1,2,3,4,5]},{y:1,p:[],s:[-1,-1,-1,-1,-1,-1,-1,-1]},{y:2,p:[],s:[-1,-1,-1,-1,-1,-1,-1,-1]},{y:3,p:[],s:[-1,-1,-1,-1,-1,-1,-1,-1]}]},{n:"",a:"blearn",i:"",b:130,l:32,s:4,g:[],h:16,o:0,e:[0,0,0,0],t:[{y:1,p:[],s:[-1]},{y:1,p:[],s:[-1]},{y:2,p:[],s:[-1]},{y:3,p:[],s:[-1]},{y:6,p:[],s:[-1]},{y:0,p:[],s:[]},{y:0,p:[],s:[]},{y:0,p:[],s:[]}]}]}},root:"assets/",img:["palette.png","tilesheet.png"],snd:[],settings:{name:"ldj46",version:"2.0.0",appid:"isGE3XQ1eMj0784k",screen:{fullscreen:!1,resizable:!0,keepAspectRatio:!1,width:128,height:128,pixelSize:{width:4,height:4}},tileSize:{width:8,height:8},palette:{name:"pico8",file:"palette",colors:["#000000","#FFF1E8","#008751","#AB5236","#7E2553","#5F574F","#29ADFF","#00E756","#FFA300","#FF77A8","#C2C3C7","#83769C","#FFFF27","#FFCCAA","#1D2B53","#FF004D"]},controls:{up:87,down:83,left:65,right:68,A:32,B:88},touchEvent:{multiTouch:!1,disableContextMenu:!0,hideMousePointer:!1},gamepad:{analogToDpad:!0,deadZone:.5},loader:{colors:["#1401C1","#DEEED6"],custom:""}}}},{}],23:[function(t,i,s){"use strict";t("pixelbox/bleeper");var r={radius:4,speed:1,hp:100,hunger:100,gold:0,x:60,y:20,sid:0},h={radius:3,x:0,y:0},a=!1,u={radius:4,searchRadius:8,x:0,y:0,sid:48,type:"m",id:0},l=[],c=100,p={radius:4,searchRadius:8,x:0,y:0,sid:35,type:"l",id:0},f=[],d=100,e=0,n={radius:3,speed:1,x:60,y:100,sid:16},$={radius:4,x:0,y:0,sid:32},v=[],y={radius:3,x:0,y:0,sid0:33,sid1:34,type:0},x=[],o=!1,m=0,g=32,_=!1,w=getMap("map");function b(){_=!1,a=!(r={radius:4,speed:.7,hp:100,hunger:100,gold:10,x:60,y:20,sid:0}),l=[],f=[],e=0,m=g,o=!(d=c=100),n={radius:3,speed:1,x:60,y:100,sid:16},v=[],x=[],patatracker.playSong(0)}function M(){var t=e;return e+=1,t}function S(){return{x:random(8,112),y:random(72,112),type:"p"}}function E(t,i){return A(t.x-i.x,t.y-i.y)<t.radius+i.radius}function k(){var t,i={x:null,y:null},s=[];return f.forEach(function(t,i){s.push({dist:j(r,t),elem:t})}),l.forEach(function(t,i){s.push({dist:j(t,r),elem:t})}),0<s.length&&(s.sort(function(t,i){return t.dist-i.dist}),t=s[0].elem,A(r.x-t.x,r.y-t.y)<r.radius+t.searchRadius&&(i=Object.assign({},s[0].elem))),i}function T(){return{x:8*random(0,15),y:8*random(0,6)+8,type:"p",radius:4}}function j(t,i){return A(t.x-i.x,t.y-i.y)}function A(t,i){return Math.sqrt(t*t+i*i)}function P(t,i,s,e){s*=32,paper(0),rectf(t,i,32,6),paper(e),rectf(t,i,s,6),pen(1),rect(t,i,32,6)}b(),s.update=function(){if(_)window.gamepad.btn.A&&b(),paper(0),rectf(24,16,80,40),pen(1),print("Game Over",32,24),print("Press 'Action'",32,40),rect(24,16,80,40);else{var t=0,i=0;window.gamepad.btn.right&&(t+=1),window.gamepad.btn.left&&--t,window.gamepad.btn.up&&--i,window.gamepad.btn.down&&(i+=1),window.gamepad.btn.A&&!o&&10<=r.gold&&(r.gold-=10,function(){x=[],v=[];for(var t=0;t<=5;t++){var i=Object.assign({},y),s=S();i.x=s.x,i.y=s.y,i.type=random(0,2),x.push(i)}for(var e=0;e<=5;e++){var n=Object.assign({},$),o=S();n.x=o.x,n.y=o.y,v.push(n)}}(),m=g,o=!0),function(t,i){var s=function(t,i){var s={x:!1,y:!1};(n.y+1+i<72||112<n.y-1+i)&&(s.y=!0);(n.x+1+t<8||112<n.x-1+t)&&(s.x=!0);return s}(t,i);s.x||(n.x+=t);s.y||(n.y+=i);if(o){var e=[];x.forEach(function(t){E(t,n)&&(e.push(t),sfx("pickup",1),0==t.type&&(100<=r.hp+10?r.hp=100:r.hp+=10),1==t.type&&(100<=r.hunger+10?r.hunger=100:r.hunger+=10))}),x=x.filter(function(t){return!e.includes(t)}),e=[],v.forEach(function(t){E(t,n)&&(e.push(t),sfx("dmg2",1),m-=g/3)}),v=v.filter(function(t){return!e.includes(t)}),m-.1<=0?m=0:m-=.1}m<=0&&(o=!1)}(t,i),function(){(r.hp<=0||r.hunger<=0)&&(_=!0,sfx("death",.3));d<=0?d=0:d-=.6,c<=0?c=0:c-=.4,d<=0&&(function(){var t=Object.assign({},p),i=T();t.x=i.x,t.y=i.y,t.id=M(),f.push(t)}(),d=100);c<=0&&(function(){var t=Object.assign({},u),i=T();t.x=i.x,t.y=i.y,t.id=M(),l.push(t)}(),c=100);if(a){var t=k();null===t.x&&null===t.y||(h=t)}else{var i={x:null,y:null};null!==(i=k()).x&&null!==i.y||(i=T()),h=i,a=!0}var s=function(t,i){var s=t-r.x,e=i-r.y,n=function(t,i){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,e=0,n=t,o=i;0==t&&0==i||(e=A(t,i),n=t/e*s,o=i/e*s);return[n,o]}(s,e,r.speed);return[n[0],n[1]]}(h.x,h.y),e=s[0],n=s[1];a&&E(r,h)&&(a=!1,"l"==h.type&&function(i){sfx("coin",.5),r.gold+=25,f=f.filter(function(t){return!(t.id==i.id)})}(h),"m"==h.type&&function(i){sfx("damage",.5),r.hp-=random(0,20)+20,r.gold+=random(0,10)+5,l=l.filter(function(t){return!(t.id==i.id)})}(h));var o=function(t,i){var s={x:!1,y:!1};(r.y+i<8||56<r.y+i)&&(s.y=!0);(r.x+t<0||120<r.x+t)&&(s.x=!0);return s}(e,n);o.x||(r.x+=e);o.y||(r.y+=n);r.hp<=0?r.hp=0:r.hp-=.001,r.hunger<=0?r.hunger=0:r.hunger-=.1}(),cls(),draw(w,0,0),o&&(x.forEach(function(t,i){0==t.type&&sprite(t.sid0,t.x,t.y),1==t.type&&sprite(t.sid1,t.x,t.y)}),v.forEach(function(t,i){sprite(t.sid,t.x,t.y)})),f.forEach(function(t,i){sprite(t.sid,t.x,t.y)}),l.forEach(function(t,i){sprite(t.sid,t.x,t.y)}),sprite(r.sid,r.x,r.y),sprite(n.sid,n.x,n.y),P(16,1,r.hp/100,9),P(80,1,r.hunger/100,14),function(t,i,s,e){paper(0),rectf(t,i,s,8),pen(11),print(e,t+2,i+1),pen(8),rect(t,i,s,8)}(7,64,114,"gold: ".concat(Math.floor(r.gold))),P(48,121,m/g,7)}}},{"pixelbox/bleeper":17}],24:[function(d,t,i){"use strict";var s=d("./projectData.json");window.settings=s.settings;var e,n,o=d("./assetLoader");function r(){e.resume(),document.body.removeEventListener("mousedown",r),document.body.removeEventListener("touchstart",r)}window.inherits=d("./inherits"),window.setFullScreen=function(){},e=null,n=window.AudioContext||window.webkitAudioContext,window.AudioContext=window.webkitAudioContext=function(){return e||(e=new n,document.body.addEventListener("mousedown",r),document.body.addEventListener("touchstart",r),e)};var h=d("audio-manager"),a=window.audioManager=new h(["sfx"]);a.settings.audioPath="audio/",a.settings.defaultFade=.3,a.init(),a.setVolume("sfx",1),window.sfx=function(t,i,s,e){a.playSound("sfx",t,i,s,e)},window.music=function(t,i,s,e){t?a.playLoopSound("sfx",t,i,0,0,s,e):a.stopLoopSound("sfx")};var u=window.btn={},l=window.btnp={},c=window.btnr={},p={},f=[],$=0;function v(){for(var t=0;t<$;t++)l[f[t]]=!1,c[f[t]]=!1}function y(t,i){var s=p[t];s&&(i&&!u[s]&&(l[s]=!0),!i&&u[s]&&(c[s]=!0),u[s]=i)}!function(){var t=settings.controls||{up:38,down:40,left:37,right:39,A:32,B:88};for(var i in t)p[t[i]]=i,u[i]=!1,l[i]=!1,c[i]=!1,f.push(i);$=f.length}(),window.addEventListener("keydown",function(t){t.preventDefault(),t.repeat||y(t.keyCode,!0)}),window.addEventListener("keyup",function(t){t.preventDefault(),y(t.keyCode,!1)}),window.chr$=function(t){return String.fromCharCode(t)},window.clamp=function(t,i,s){return Math.max(i,Math.min(s,t))},window.random=function(t,i){return void 0===i?~~(t*Math.random()):~~(t+Math.random()*(i-t))};var x=d("./Texture"),m=d("./TileMap");d("./Texture/canvas2D"),d("./Texture/textCanvas2D"),window.texture=function(t){var i=new x(t.width,t.height);return i.clear().draw(t,0,0),i},window.tilesheet=function(t){return x.prototype.setGlobalTilesheet(t)};var g=function(){var t=settings.screen,a=t.width,u=t.height,l=t.pixelSize,i=window.$screen=new x(a,u),s=i.canvas,e=s.style;if(document.body.appendChild(s),t.fullscreen)if(t.keepAspectRatio){var n=function(){var t=window.innerWidth,i=window.innerHeight,s=a*l.width,e=u*l.height,n=Math.min(t/s,i/e),o=s*n,r=e*n,h=$screen.canvas.style;h.width=o+"px",h.height=r+"px",h.left=(t-o)/2+"px",h.top=(i-r)/2+"px"};addEventListener("resize",n),n()}else e.width=e.height="100%";else e.width=a*l.width+"px",e.height=u*l.height+"px";return i}();window.cls=function(){return g.cls()},window.sprite=function(t,i,s,e,n,o){return g.sprite(t,i,s,e,n,o)},window.draw=function(t,i,s,e,n,o){return g.draw(t,i,s,e,n,o)},window.rect=function(t,i,s,e){return g.rect(t,i,s,e)},window.rectf=function(t,i,s,e){return g.rectf(t,i,s,e)},window.camera=function(t,i){return g.setCamera(t,i)},window.pen=function(t){return g.pen(t)},window.paper=function(t){return g.paper(t)},window.locate=function(t,i){return g.locate(t,i)},window.print=function(t,i,s){return g.print(t,i,s)},window.println=function(t){return g.println(t)},window.getMap=m.getMap,window.rectfill=window.rectf,g.canvas.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var _=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1/60)};window.frameId=0;var w=~~(settings.screen.width/2),b=~~(settings.screen.width/4),M=~~(settings.screen.height/2);var S=["#000","#FFF"],E=settings.loader&&settings.loader.colors||settings.loaderColors||S;Array.isArray(E)||(E=S);var k=d("./Color");g.setPalette([(new k).fromString(E[0]),(new k).fromString(E[1])]),paper(0),cls(),paper(1),pen(1),rect(w-b-2,M-4,2*b+4,8),o.preloadStaticAssets(s,function(t,f){if(paper(0).pen(1).cls(),t)return console.error(t),void print(t);window.assets=f;var i=window.bleeper=d("./bleeper");f.bleeper&&i.loadProgram(f.bleeper);var s=window.patatracker=d("./pataTracker");f.patatracker&&s.loadData(f.patatracker),function(){var t=d("./Color"),i=settings.palette;if(i.file){for(var s=i.file.split("/"),e=f;e&&s.length;)e=e[s.shift()];if(!e)return;var n=e.width,o=e.height,r=e.x||0,h=e.y||0;e._isSprite&&(e=e.img);var a=d("./domUtils/createCanvas")(n,o).getContext("2d");a.drawImage(e,r,h,n,o,0,0,n,o);for(var u=a.getImageData(0,0,n,o).data,l=[],c=0;c<u.length;c+=4)u[c+3]<=1||l.push((new t).fromPixel(u,c));g.setPalette(l)}else{var p;for(p=i.colors?i.colors:i,l=[],c=0;c<p.length;c++)l.push((new t).fromString(p[c]));g.setPalette(l)}}(),f.tilesheet&&tilesheet(f.tilesheet),m.loadBank(f.maps);var e=d("./gamepad"),n=settings.gamepad||{};n.analogToDpad&&e.mapAnalogStickToDpad(n.deadZone);var o=d("../../src/main.js");o.update&&(v(),function t(){window.frameId+=1,e.update(),o.update(),v(),_(t)}())},function(t,i,s,e){rect(w-b-2,M-4,2*b+4,8),rectf(w-b,M-2,~~(e*b*2),4)})},{"../../src/main.js":23,"./Color":11,"./Texture":13,"./Texture/canvas2D":12,"./Texture/textCanvas2D":14,"./TileMap":15,"./assetLoader":16,"./bleeper":17,"./domUtils/createCanvas":18,"./gamepad":19,"./inherits":20,"./pataTracker":21,"./projectData.json":22,"audio-manager":5}]},{},[24]);